
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>tomcat · spring-note</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="doctording">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-filename/block.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="distribute.html" />
    
    
    <link rel="prev" href="rpc.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    [1 常见设计模式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../design_pattern/proxy.html">
            
                <a href="../design_pattern/proxy.html">
            
                    
                    代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../design_pattern/singleton.html">
            
                <a href="../design_pattern/singleton.html">
            
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../design_pattern/factory.html">
            
                <a href="../design_pattern/factory.html">
            
                    
                    工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../design_pattern/template.html">
            
                <a href="../design_pattern/template.html">
            
                    
                    模板方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../design_pattern/strategy.html">
            
                <a href="../design_pattern/strategy.html">
            
                    
                    策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../design_pattern/decorator.html">
            
                <a href="../design_pattern/decorator.html">
            
                    
                    装饰器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../design_pattern/observer.html">
            
                <a href="../design_pattern/observer.html">
            
                    
                    观察者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../design_pattern/visitor.html">
            
                <a href="../design_pattern/visitor.html">
            
                    
                    访问者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../design_pattern/iterator.html">
            
                <a href="../design_pattern/iterator.html">
            
                    
                    迭代器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../design_pattern/facade.html">
            
                <a href="../design_pattern/facade.html">
            
                    
                    门面模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    [2 数据结构和算法基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java_data_structure/java_basic_datastructure.html">
            
                <a href="../java_data_structure/java_basic_datastructure.html">
            
                    
                    常见基础数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../java_data_structure/array_list.html">
            
                <a href="../java_data_structure/array_list.html">
            
                    
                    ArrayList & LinkedList
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../java_data_structure/hash_map.html">
            
                <a href="../java_data_structure/hash_map.html">
            
                    
                    HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../java_data_structure/hash_table.html">
            
                <a href="../java_data_structure/hash_table.html">
            
                    
                    HashTable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../java_utils/Map.html">
            
                <a href="../java_utils/Map.html">
            
                    
                    HashMap,HashTable,ConcurrentHashMap 对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../java_data_structure/fail_fast.html">
            
                <a href="../java_data_structure/fail_fast.html">
            
                    
                    fail-fast,ConcurrentModificationException
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../java_utils/quick_sort.html">
            
                <a href="../java_utils/quick_sort.html">
            
                    
                    快排(没事手写写)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../java_data_structure/concurrent_datastructure.html">
            
                <a href="../java_data_structure/concurrent_datastructure.html">
            
                    
                    concurrent数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../java_data_structure/advanced_structure.html">
            
                <a href="../java_data_structure/advanced_structure.html">
            
                    
                    高级数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../java_data_structure/b_tree.html">
            
                <a href="../java_data_structure/b_tree.html">
            
                    
                    B/B+ Tree
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    [3 Java基础问题]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../java_data_structure/System_arraycopy.html">
            
                <a href="../java_data_structure/System_arraycopy.html">
            
                    
                    System.arraycopy, Array.copyOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../java_utils/equals_hashcode.html">
            
                <a href="../java_utils/equals_hashcode.html">
            
                    
                    == & equals方法 & hashcode方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../java_utils/Calendar.html">
            
                <a href="../java_utils/Calendar.html">
            
                    
                    Calendar & Date
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../java_utils/Compare.html">
            
                <a href="../java_utils/Compare.html">
            
                    
                    Comparison method violates its general contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../java_utils/int_Integer.html">
            
                <a href="../java_utils/int_Integer.html">
            
                    
                    int(基本类型) & Integer(包装类类型)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../java_utils/exception.html">
            
                <a href="../java_utils/exception.html">
            
                    
                    Java异常&错误
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../java_utils/String.html">
            
                <a href="../java_utils/String.html">
            
                    
                    String,StringBuffer,StringBuilder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../java_utils/reflect.html">
            
                <a href="../java_utils/reflect.html">
            
                    
                    反射机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../java_utils/call_back.html">
            
                <a href="../java_utils/call_back.html">
            
                    
                    回调 & 事件机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../java_utils/array_collection.html">
            
                <a href="../java_utils/array_collection.html">
            
                    
                    数组，集合转换等问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../java_utils/annotation.html">
            
                <a href="../java_utils/annotation.html">
            
                    
                    注解 Annotation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../java_jvm/jvm_runtime.html">
            
                <a href="../java_jvm/jvm_runtime.html">
            
                    
                    Runtime类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../java_data_structure/unsafe.html">
            
                <a href="../java_data_structure/unsafe.html">
            
                    
                    unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../java_thinking_in_Java/basic.html">
            
                <a href="../java_thinking_in_Java/basic.html">
            
                    
                    《Java编程思想》第3章：操作符，第4章：控制执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../java_thinking_in_Java/constructor.html">
            
                <a href="../java_thinking_in_Java/constructor.html">
            
                    
                    《Java编程思想》第5章：初始化和清理(重点)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../java_thinking_in_Java/public_private_protect.html">
            
                <a href="../java_thinking_in_Java/public_private_protect.html">
            
                    
                    《Java编程思想》第6章：访问权限控制(重要)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第7章：复用类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../java_thinking_in_Java/polymorphism.html">
            
                <a href="../java_thinking_in_Java/polymorphism.html">
            
                    
                    《Java编程思想》第8章：多态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.19" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第9章：接口 补充：抽象类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.20" data-path="../java_thinking_in_Java/innner_class.html">
            
                <a href="../java_thinking_in_Java/innner_class.html">
            
                    
                    《Java编程思想》第10章：内部类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    [4 Java多线程 & 并发基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../java_thread_concurrent/thread_basic.html">
            
                <a href="../java_thread_concurrent/thread_basic.html">
            
                    
                    线程基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../java_thread_concurrent/thread_design.html">
            
                <a href="../java_thread_concurrent/thread_design.html">
            
                    
                    多线程设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../java_thread_concurrent/hook_thread.html">
            
                <a href="../java_thread_concurrent/hook_thread.html">
            
                    
                    Hook线程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../java_thread_concurrent/thread_pool.html">
            
                <a href="../java_thread_concurrent/thread_pool.html">
            
                    
                    线程池
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../java_thread_concurrent/concurrency_problems.html">
            
                <a href="../java_thread_concurrent/concurrency_problems.html">
            
                    
                    常见的多线程题目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../java_thread_concurrent/thread_pool_self.html">
            
                <a href="../java_thread_concurrent/thread_pool_self.html">
            
                    
                    自定义线程池
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../java_thread_concurrent/cas.html">
            
                <a href="../java_thread_concurrent/cas.html">
            
                    
                    CAS(Conmpare And Swap/Exchange) & unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../java_thread_concurrent/aqs.html">
            
                <a href="../java_thread_concurrent/aqs.html">
            
                    
                    AQS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" >
            
                <span>
            
                    
                    [常见关键字和类]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.5.1" data-path="../java_thread_concurrent/countdownlatch_cyclicBarrier.html">
            
                <a href="../java_thread_concurrent/countdownlatch_cyclicBarrier.html">
            
                    
                    CountDownLatch & CyclicBarrier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.2" data-path="../java_thread_concurrent/longAdder.html">
            
                <a href="../java_thread_concurrent/longAdder.html">
            
                    
                    LongAdder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.3" data-path="../java_thread_concurrent/semaphore.html">
            
                <a href="../java_thread_concurrent/semaphore.html">
            
                    
                    Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.4" data-path="../java_thread_concurrent/volatile.html">
            
                <a href="../java_thread_concurrent/volatile.html">
            
                    
                    volatile 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.5" data-path="../java_thread_concurrent/synchronized.html">
            
                <a href="../java_thread_concurrent/synchronized.html">
            
                    
                    synchronized 关键字
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../java_thread_concurrent/thread_lock.html">
            
                <a href="../java_thread_concurrent/thread_lock.html">
            
                    
                    Java Lock
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="../java_thread_concurrent/thread_lock_type.html">
            
                <a href="../java_thread_concurrent/thread_lock_type.html">
            
                    
                    Java Lock 分类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2" data-path="../java_thread_concurrent/thread_deadlock.html">
            
                <a href="../java_thread_concurrent/thread_deadlock.html">
            
                    
                    Thread 死锁问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../java_thread_concurrent/threadLocal.html">
            
                <a href="../java_thread_concurrent/threadLocal.html">
            
                    
                    ThreadLocal
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    [5 Java8]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../java8/java8_completableFuture.html">
            
                <a href="../java8/java8_completableFuture.html">
            
                    
                    CompletableFuture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../java8/java8_future.html">
            
                <a href="../java8/java8_future.html">
            
                    
                    Future
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../java8/interface_default.html">
            
                <a href="../java8/interface_default.html">
            
                    
                    interface defalt static
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../java8/java8_mem.html">
            
                <a href="../java8/java8_mem.html">
            
                    
                    Java8 jvm内存结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../java8/lambda.html">
            
                <a href="../java8/lambda.html">
            
                    
                    Java8 lambda表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../java8/java8_optional.html">
            
                <a href="../java8/java8_optional.html">
            
                    
                    Java8 Optional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../java8/streams.html">
            
                <a href="../java8/streams.html">
            
                    
                    Java8 Streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../java8/streams_parallel.html">
            
                <a href="../java8/streams_parallel.html">
            
                    
                    Java8 并行数据处理与性能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    [6 JVM]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../java_jvm/jvm_mem_model.html">
            
                <a href="../java_jvm/jvm_mem_model.html">
            
                    
                    内存模型与线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../java_jvm/jvm_class_load.html">
            
                <a href="../java_jvm/jvm_class_load.html">
            
                    
                    类加载机制,类加载器,内存布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../java_jvm/jvm_mem_gc.html">
            
                <a href="../java_jvm/jvm_mem_gc.html">
            
                    
                    堆栈 & 各种GC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../java_jvm/jvm_params.html">
            
                <a href="../java_jvm/jvm_params.html">
            
                    
                    JVM参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../java_jvm/jvm_tools.html">
            
                <a href="../java_jvm/jvm_tools.html">
            
                    
                    JVM命令工具(jstack,jmap,jcmd...)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    [7 缓存 & 限流]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../db_cache/LFU.html">
            
                <a href="../db_cache/LFU.html">
            
                    
                    LFU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../db_cache/LRU.html">
            
                <a href="../db_cache/LRU.html">
            
                    
                    LRU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../db_cache/consistent_hash.html">
            
                <a href="../db_cache/consistent_hash.html">
            
                    
                    一致性Hash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../db_cache/bloom.html">
            
                <a href="../db_cache/bloom.html">
            
                    
                    布隆过滤器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../db_cache/cache.html">
            
                <a href="../db_cache/cache.html">
            
                    
                    缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="flow_limit.html">
            
                <a href="flow_limit.html">
            
                    
                    限流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../java_thread_concurrent/cpu_cache.html">
            
                <a href="../java_thread_concurrent/cpu_cache.html">
            
                    
                    CPU,缓存
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    [8 数据库]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../db_cache/mysql.html">
            
                <a href="../db_cache/mysql.html">
            
                    
                    数据库/表/查询
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    [9 I/O & 网络 & 分布式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" >
            
                <span>
            
                    
                    [I/O与网络]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="../java_io_net/io_interrupte.html">
            
                <a href="../java_io_net/io_interrupte.html">
            
                    
                    IO和中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="../java_io_net/http_tcp.html">
            
                <a href="../java_io_net/http_tcp.html">
            
                    
                    http & tcp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.3" data-path="../java_io_net/io_basic.html">
            
                <a href="../java_io_net/io_basic.html">
            
                    
                    IO基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.4" data-path="../java_io_net/nio_basic.html">
            
                <a href="../java_io_net/nio_basic.html">
            
                    
                    nio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5" data-path="../java_io_net/from_io_to_epoll.html">
            
                <a href="../java_io_net/from_io_to_epoll.html">
            
                    
                    从io到epoll
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="nginx.html">
            
                <a href="nginx.html">
            
                    
                    nginx基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="rpc.html">
            
                <a href="rpc.html">
            
                    
                    rpc
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.4" data-path="tomcat.html">
            
                <a href="tomcat.html">
            
                    
                    tomcat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="distribute.html">
            
                <a href="distribute.html">
            
                    
                    分布式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="design.html">
            
                <a href="design.html">
            
                    
                    网络设计模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    [10 剑指offer]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../thought_of_solve/thought.html">
            
                <a href="../thought_of_solve/thought.html">
            
                    
                    剑指Offer解题思路(全)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >tomcat</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div class="treeview__container"><div class="treeview__container-title"><span class="treeview__main-title">Treeview</span><span class="treeview__copyright">Copyright @doctording all right reserved, powered by <a href="https://github.com/aleen42" target="_blank">aleen42</a></span></div><ul>
<li><div><a href="#tomcat">Tomcat</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x51E0;&#x4E2A;&#x95EE;&#x9898;">&#x51E0;&#x4E2A;&#x95EE;&#x9898;</a><i></i></div></li>
<li><div><a href="#tomcat&#x662F;&#x4E00;&#x4E2A;servlet&#x5BB9;&#x5668;&#xFF1F;">Tomcat&#x662F;&#x4E00;&#x4E2A;Servlet&#x5BB9;&#x5668;&#xFF1F;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#servlet">Servlet</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#servlet&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x67B6;&#x6784;&#x4F4D;&#x7F6E;">Servlet&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x67B6;&#x6784;&#x4F4D;&#x7F6E;</a><i></i></div></li>
<li><div><a href="#servlet&#x67B6;&#x6784;&#x56FE;">Servlet&#x67B6;&#x6784;&#x56FE;</a><i></i></div></li>
<li><div><a href="#servlet&#x751F;&#x547D;&#x5468;&#x671F;">Servlet&#x751F;&#x547D;&#x5468;&#x671F;</a><i></i></div></li>
<li><div><a href="#&#x5982;&#x4F55;&#x521B;&#x5EFA;-servlet-">&#x5982;&#x4F55;&#x521B;&#x5EFA; Servlet ?</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x5E94;&#x7528;&#x90E8;&#x7F72;how-to-deploy">&#x5E94;&#x7528;&#x90E8;&#x7F72;(how to deploy?)</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#war&#x5305;&#x548C;jar&#x5305;&#x7684;&#x533A;&#x522B;&#xFF1F;">War&#x5305;&#x548C;Jar&#x5305;&#x7684;&#x533A;&#x522B;&#xFF1F;</a><i></i></div></li>
</ul></li>
</ul></li>
<li><div><a href="#tomcat&#x67B6;&#x6784;">Tomcat&#x67B6;&#x6784;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#tomcat-&#x5982;&#x4F55;&#x5904;&#x7406;&#x8BF7;&#x6C42;">Tomcat &#x5982;&#x4F55;&#x5904;&#x7406;&#x8BF7;&#x6C42;</a><i></i></div></li>
<li><div><a href="#connector&#x6839;&#x636E;&#x534F;&#x8BAE;&#x786E;&#x5B9A;&#x7F51;&#x7EDC;io&#x6A21;&#x578B;">Connector(&#x6839;&#x636E;&#x534F;&#x8BAE;&#x786E;&#x5B9A;&#x7F51;&#x7EDC;IO&#x6A21;&#x578B;)</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#orgapachecoyotehttp11http11protocol">org.apache.coyote.http11.Http11Protocol</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#jioendpoint">JIoEndpoint</a><i></i></div></li>
<li><div><a href="#jioendpoint-acceptor">JIoEndpoint Acceptor</a><i></i></div></li>
<li><div><a href="#bio&#x6A21;&#x578B;">BIO&#x6A21;&#x578B;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x9644;&#xFF1A;&#x9650;&#x6D41;&#x7EC4;&#x4EF6;limitlatch">&#x9644;&#xFF1A;&#x9650;&#x6D41;&#x7EC4;&#x4EF6;LimitLatch</a><i></i></div></li>
<li><div><a href="#&#x9644;&#xFF1A;standardthreadexecutortomcat-70105&#x57FA;&#x4E8E;jdkthreadpoolexecutor">&#x9644;&#xFF1A;StandardThreadExecutor(Tomcat 7.0.105,&#x57FA;&#x4E8E;JDKThreadPoolExecutor)</a><i></i></div></li>
</ul></li>
</ul></li>
<li><div><a href="#orgapachecoyotehttp11http11nioprotocol">org.apache.coyote.http11.Http11NioProtocol</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#nioendpoint">NioEndpoint</a><i></i></div></li>
<li><div><a href="#nioendpoint&#x7684;&#x521D;&#x59CB;&#x5316;">NioEndpoint&#x7684;&#x521D;&#x59CB;&#x5316;</a><i></i></div></li>
<li><div><a href="#nioendpoint-acceptor">NioEndpoint Acceptor</a><i></i></div></li>
<li><div><a href="#&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;nio&#xFF08;none-blocking-io&#xFF09;">&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;NIO&#xFF08;None Blocking IO&#xFF09;</a><i></i></div></li>
<li><div><a href="#&#x8865;&#x5145;&#xFF1A;&#x5982;&#x4F55;&#x907F;&#x514D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;nio&#x6A21;&#x578B;&#x4E2D;&#x8F6E;&#x8BE2;&#x7B49;&#x5F85;&#x7684;&#x95EE;&#x9898;&#x5462;&#xFF1F;">&#x8865;&#x5145;&#xFF1A;&#x5982;&#x4F55;&#x907F;&#x514D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;NIO&#x6A21;&#x578B;&#x4E2D;&#x8F6E;&#x8BE2;&#x7B49;&#x5F85;&#x7684;&#x95EE;&#x9898;&#x5462;&#xFF1F;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x590D;&#x4E60;&#x963B;&#x585E;&#x975E;&#x963B;&#x585E;&#xFF0C;&#x540C;&#x6B65;&#x5F02;&#x6B65;&#x7684;&#x6982;&#x5FF5;">&#x590D;&#x4E60;&#x963B;&#x585E;/&#x975E;&#x963B;&#x585E;&#xFF0C;&#x540C;&#x6B65;/&#x5F02;&#x6B65;&#x7684;&#x6982;&#x5FF5;</a><i></i></div></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>


<p>[TOC]</p>
<h1 id="tomcat">Tomcat</h1>
<p>&#x76F4;&#x63A5;&#x8BA4;&#x8BC6;&#xFF1A;&#x4E00;&#x4E2A;URL&#x8BBF;&#x95EE;&#xFF0C;&#x7ECF;&#x8FC7;<code>Tomcat</code>&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x5C06;&#x8BF7;&#x6C42;&#x4F20;&#x9012;&#x7ED9;SpringBoot/SpringMvc&#x7684;Controller</p>
<h2 id="&#x51E0;&#x4E2A;&#x95EE;&#x9898;">&#x51E0;&#x4E2A;&#x95EE;&#x9898;</h2>
<ol>
<li>&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;Tomcat&#x662F;&#x4E00;&#x4E2A;Servlet&#x5BB9;&#x5668;&#xFF1F;</li>
<li>Tomcat&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#xFF1F;</li>
<li>War&#x5305;&#x548C;Jar&#x5305;&#x7684;&#x533A;&#x522B;&#xFF1F;</li>
<li>Tomcat&#x662F;&#x600E;&#x4E48;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#xFF0C;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x6D41;&#x7A0B;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#xFF1F;</li>
<li>Tcp,Http,Socket,Tomcat&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>
</ol>
<h2 id="tomcat&#x662F;&#x4E00;&#x4E2A;servlet&#x5BB9;&#x5668;&#xFF1F;">Tomcat&#x662F;&#x4E00;&#x4E2A;Servlet&#x5BB9;&#x5668;&#xFF1F;</h2>
<pre class="language-"><code class="lang-java"><span class="token keyword">class</span> <span class="token class-name">Tomcat</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Servlet</span><span class="token punctuation">&gt;</span></span> servlets<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="servlet">Servlet</h3>
<h4 id="servlet&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x67B6;&#x6784;&#x4F4D;&#x7F6E;">Servlet&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x67B6;&#x6784;&#x4F4D;&#x7F6E;</h4>
<p><img src="imgs/servlet-arch.jpg" alt=""></p>
<h4 id="servlet&#x67B6;&#x6784;&#x56FE;">Servlet&#x67B6;&#x6784;&#x56FE;</h4>
<p><img src="imgs/Servlet-LifeCycle.jpg" alt=""></p>
<ol>
<li>&#x7B2C;&#x4E00;&#x4E2A;&#x5230;&#x8FBE;&#x670D;&#x52A1;&#x5668;&#x7684; HTTP &#x8BF7;&#x6C42;&#x88AB;&#x59D4;&#x6D3E;&#x5230; Servlet &#x5BB9;&#x5668;&#x3002;</li>
<li>Servlet &#x5BB9;&#x5668;&#x5728;&#x8C03;&#x7528; service() &#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#x52A0;&#x8F7D; Servlet&#x3002;</li>
<li>&#x7136;&#x540E; Servlet &#x5BB9;&#x5668;&#x5904;&#x7406;&#x7531;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4EA7;&#x751F;&#x7684;&#x591A;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684; Servlet &#x5B9E;&#x4F8B;&#x7684; service() &#x65B9;&#x6CD5;&#x3002;</li>
</ol>
<h4 id="servlet&#x751F;&#x547D;&#x5468;&#x671F;">Servlet&#x751F;&#x547D;&#x5468;&#x671F;</h4>
<p>Servlet &#x751F;&#x547D;&#x5468;&#x671F;&#x53EF;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#x4ECE;&#x521B;&#x5EFA;&#x76F4;&#x5230;&#x6BC1;&#x706D;&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x3002;&#x4EE5;&#x4E0B;&#x662F; Servlet &#x9075;&#x5FAA;&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<ol>
<li>Servlet &#x901A;&#x8FC7;&#x8C03;&#x7528;<code>init()</code>&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</li>
<li>Servlet &#x8C03;&#x7528;<code>service()</code>&#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x3002;</li>
<li>Servlet &#x901A;&#x8FC7;&#x8C03;&#x7528;<code>destroy()</code>&#x65B9;&#x6CD5;&#x7EC8;&#x6B62;&#xFF08;&#x7ED3;&#x675F;&#xFF09;&#x3002;</li>
<li>&#x6700;&#x540E;&#xFF0C;Servlet &#x662F;&#x7531; JVM &#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x8FDB;&#x884C;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x3002;</li>
</ol>
<p><code>service()</code>&#x65B9;&#x6CD5;&#x662F;&#x6267;&#x884C;&#x5B9E;&#x9645;&#x4EFB;&#x52A1;&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#x3002;Servlet &#x5BB9;&#x5668;&#xFF08;&#x5373; Web &#x670D;&#x52A1;&#x5668;&#xFF09;&#x8C03;&#x7528; <code>service()</code> &#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x6D4F;&#x89C8;&#x5668;&#xFF09;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x628A;&#x683C;&#x5F0F;&#x5316;&#x7684;&#x54CD;&#x5E94;&#x5199;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x6BCF;&#x6B21;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A; Servlet &#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x5E76;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x3002;<code>service()</code> &#x65B9;&#x6CD5;&#x68C0;&#x67E5; HTTP &#x8BF7;&#x6C42;&#x7C7B;&#x578B;&#xFF08;GET&#x3001;POST&#x3001;PUT&#x3001;DELETE &#x7B49;&#xFF09;&#xFF0C;&#x5E76;&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528; <code>doGet</code>&#x3001;<code>doPost</code>&#x3001;<code>doPut</code>&#xFF0C;<code>doDelete</code>&#x7B49;&#x65B9;&#x6CD5;&#x3002;</p>
<ul>
<li>doGet&#x65B9;&#x6CD5;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                  <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// Servlet &#x4EE3;&#x7801;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><code>doPost()</code>&#x65B9;&#x6CD5;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                   <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// Servlet &#x4EE3;&#x7801;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="&#x5982;&#x4F55;&#x521B;&#x5EFA;-servlet-">&#x5982;&#x4F55;&#x521B;&#x5EFA; Servlet ?</h4>
<ul>
<li><p>&#x5B9E;&#x73B0; <code>Servlet</code> &#x63A5;&#x53E3;</p>
</li>
<li><p>&#x7EE7;&#x627F; <code>GenericServlet</code> &#x7C7B;</p>
</li>
</ul>
<p><code>GenericServlet</code>&#x5B9E;&#x73B0;&#x4E86; Servlet &#x63A5;&#x53E3;&#x9664;&#x4E86; service &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x6781;&#x5C11;&#x7528;)</p>
<ul>
<li>&#x7EE7;&#x627F; <code>HttpServlet</code> &#x65B9;&#x6CD5;</li>
</ul>
<p>HttpServlet &#x7C7B;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86; Http &#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;HttpServlet &#x6269;&#x5C55;&#x4E86; GenericServlet &#x7C7B;&#xFF0C;&#x800C; GenericServlet &#x7C7B;&#x53C8;&#x5B9E;&#x73B0;&#x4E86; Servlet &#x7C7B;&#x548C; ServletConfig &#x7C7B;</p>
<h3 id="&#x5E94;&#x7528;&#x90E8;&#x7F72;how-to-deploy">&#x5E94;&#x7528;&#x90E8;&#x7F72;(how to deploy?)</h3>
<p>// todo</p>
<h4 id="war&#x5305;&#x548C;jar&#x5305;&#x7684;&#x533A;&#x522B;&#xFF1F;">War&#x5305;&#x548C;Jar&#x5305;&#x7684;&#x533A;&#x522B;&#xFF1F;</h4>
<ul>
<li>archive</li>
</ul>
<p>n. &#x6863;&#x6848;; &#x6863;&#x6848;&#x9986;; &#x6863;&#x6848;&#x5BA4;;
v. &#x628A;&#x2026;&#x5B58;&#x6863;; &#x628A;&#x2026;&#x5F52;&#x6863;; &#x5C06;(&#x4E0D;&#x5E38;&#x7528;&#x4FE1;&#x606F;)&#x5B58;&#x6863;;</p>
<ul>
<li>A JAR file is a file that contains all components to make a self-contained executable <code>Java application</code>. Moreover, a JAR file includes compiled Java source code, manifest file, XML based configuration data, JSON based data files, images and audio. It is an aggregation of all these files into a single, compressed file. Compressing all the files helps to reduce the size of the application. Furthermore, it makes it easier to move the JAR file over the network between different platforms. Every Java Development Kit (JDK) includes a JAR utility to support JAR files. It allows creating new JAR files with a manifest file and extracting all the content of a JAR file onto the file system. Moreover, JAR utility helps to update existing JAR files.</li>
</ul>
<p>Most JAR files are simply containers for data that another program needs to run with Java; therefore you cannot run these files and nothing will happen when you double-click them. Similarly, most executable JAR files are downloaded as installation files to install applications or programs.</p>
<ul>
<li>A WAR file contains files related to a <code>web project</code>. It contains servlet, JSP, XML, HTML, CSS, and JavaScript files that can be deployed on any servlet/JSP container. The jar tool of JDK helps to create a WAR file. These files are inside the WEB-INF folder of the project. A WAR file combines all the files into a single unit. Therefore, it takes a minimum amount of time to transfer a file from client to server.</li>
</ul>
<p>WAR files need to be deployed on web container like Apache Tomcat, Jetty, Wildfly etc or it will also deployed on application server.</p>
<h2 id="tomcat&#x67B6;&#x6784;">Tomcat&#x67B6;&#x6784;</h2>
<p><img src="imgs/tomcat_01.png" alt=""></p>
<ul>
<li>&#x56DE;&#x7B54;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;Tomcat&#x662F;&#x4E00;&#x4E2A;Servlet&#x5BB9;&#x5668;&#xFF1F;<ol>
<li>4&#x4E2A;&#x5BB9;&#x5668;&#xFF1A;Engine, Host, Context&#xFF0C;Wrapper</li>
<li>&#x6700;&#x540E;Servlet&#x5B9E;&#x4F8B;&#x6267;&#x884C;<code>service</code>&#x65B9;&#x6CD5;</li>
</ol>
</li>
</ul>
<h3 id="tomcat-&#x5982;&#x4F55;&#x5904;&#x7406;&#x8BF7;&#x6C42;">Tomcat &#x5982;&#x4F55;&#x5904;&#x7406;&#x8BF7;&#x6C42;</h3>
<p>Tomcat&#x8981;&#x4ECE;Socket&#x8BFB;&#x53D6;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x8981;&#x6D89;&#x53CA;&#x5230;I/O&#xFF0C;tomcat I/O&#x5305;&#x62EC;:</p>
<ol>
<li>NIO</li>
<li>BIO</li>
<li>AIO</li>
<li>AJP</li>
</ol>
<pre class="language-"><code class="lang-java">socket <span class="token operator">--</span><span class="token operator">&gt;</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> parse <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">Request</span>
</code></pre>
<h3 id="connector&#x6839;&#x636E;&#x534F;&#x8BAE;&#x786E;&#x5B9A;&#x7F51;&#x7EDC;io&#x6A21;&#x578B;">Connector(&#x6839;&#x636E;&#x534F;&#x8BAE;&#x786E;&#x5B9A;&#x7F51;&#x7EDC;IO&#x6A21;&#x578B;)</h3>
<p>&#x89C1;&#xFF1A;Tomcat7 &#x7684; Connector&#x7C7B;&#xFF0C;&#x914D;&#x7F6E;&#x53C2;&#x8003;&#xFF1A;<a href="https://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_blank">HTTP Connector config</a></p>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
    * Set the Coyote protocol which will be used by the connector.
    *
    * @param protocol The Coyote protocol name
    */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProtocol</span><span class="token punctuation">(</span><span class="token class-name">String</span> protocol<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AprLifecycleListener</span><span class="token punctuation">.</span><span class="token function">isAprAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;HTTP/1.1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            setProtocolHandlerClassName
            <span class="token punctuation">(</span><span class="token string">&quot;org.apache.coyote.http11.Http11AprProtocol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;AJP/1.3&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            setProtocolHandlerClassName
            <span class="token punctuation">(</span><span class="token string">&quot;org.apache.coyote.ajp.AjpAprProtocol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>protocol <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setProtocolHandlerClassName</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            setProtocolHandlerClassName
            <span class="token punctuation">(</span><span class="token string">&quot;org.apache.coyote.http11.Http11AprProtocol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;HTTP/1.1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            setProtocolHandlerClassName
            <span class="token punctuation">(</span><span class="token string">&quot;org.apache.coyote.http11.Http11Protocol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;AJP/1.3&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            setProtocolHandlerClassName
            <span class="token punctuation">(</span><span class="token string">&quot;org.apache.coyote.ajp.AjpProtocol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>protocol <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setProtocolHandlerClassName</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>HTTP&#x4F7F;&#x7528;&#x7684;&#x662F;<code>org.apache.coyote.http11.Http11Protocol</code>&#x5904;&#x7406;&#x7684;</p>
<h4 id="orgapachecoyotehttp11http11protocol">org.apache.coyote.http11.Http11Protocol</h4>
<p>tomcat7 &#x6E90;&#x7801;&#x4E2D;</p>
<ul>
<li><code>public class Http11Protocol extends AbstractHttp11JsseProtocol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Socket</span><span class="token punctuation">&gt;</span></span></code></li>
<li><code>public class Http11NioProtocol extends AbstractHttp11JsseProtocol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NioChannel</span><span class="token punctuation">&gt;</span></span></code></li>
</ul>
<h5 id="jioendpoint">JIoEndpoint</h5>
<p><code>JIoEndpoint</code>&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5904;&#x7406;&#x8BBF;&#x95EE;&#x7684;TCP&#x8FDE;&#x63A5;.&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x4E00;&#x4E2A;<code>Acceptor</code>&#x7EBF;&#x7A0B;,&#x5B83;&#x5C06;&#x542F;&#x7528;&#x4E00;&#x4E2A;<code>&#x963B;&#x585E;&#x578B;Socket</code>&#x76D1;&#x542C;Tcp&#x8FDE;&#x63A5;,&#x83B7;&#x5F97;&#x8FDE;&#x63A5;&#x540E;&#x5BF9;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x542F;&#x52A8;&#x4E00;&#x4E2A;worker&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5904;&#x7406;.&#xFF08;&#x5E38;&#x89C4;&#x7684;BIO&#x6A21;&#x578B;&#xFF09;</p>
<h5 id="jioendpoint-acceptor">JIoEndpoint Acceptor</h5>
<pre class="language-"><code class="lang-java"><span class="token comment">// --------------------------------------------------- Acceptor Inner Class</span>
<span class="token comment">/**
    * The background thread that listens for incoming TCP/IP connections and
    * hands them off to an appropriate processor.
    */</span>
<span class="token keyword">protected</span> <span class="token keyword">class</span> <span class="token class-name">Acceptor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEndpoint</span><span class="token punctuation">.</span><span class="token class-name">Acceptor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> errorDelay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// Loop until we receive a shutdown command</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// Loop if endpoint is paused</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>paused <span class="token operator">&amp;&amp;</span> running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                state <span class="token operator">=</span> <span class="token class-name">AcceptorState</span><span class="token punctuation">.</span>PAUSED<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Ignore</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            state <span class="token operator">=</span> <span class="token class-name">AcceptorState</span><span class="token punctuation">.</span>RUNNING<span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//if we have reached max connections, wait</span>
                <span class="token function">countUpOrAwaitConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Accept the next incoming connection from the server</span>
                    <span class="token comment">// socket</span>
                    socket <span class="token operator">=</span> serverSocketFactory<span class="token punctuation">.</span><span class="token function">acceptSocket</span><span class="token punctuation">(</span>serverSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ioe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Introduce delay if necessary</span>
                    errorDelay <span class="token operator">=</span> <span class="token function">handleExceptionWithDelay</span><span class="token punctuation">(</span>errorDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// re-throw</span>
                    <span class="token keyword">throw</span> ioe<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// Successful accept, reset the error delay</span>
                errorDelay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token comment">// Configure the socket</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>running <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>paused <span class="token operator">&amp;&amp;</span> <span class="token function">setSocketOptions</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Hand this socket off to an appropriate processor</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">processSocket</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// Close socket right away</span>
                        <span class="token function">closeSocket</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Close socket right away</span>
                    <span class="token function">closeSocket</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint.accept.fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NullPointerException</span> npe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint.accept.fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> npe<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint.accept.fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        state <span class="token operator">=</span> <span class="token class-name">AcceptorState</span><span class="token punctuation">.</span>ENDED<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>&#x963B;&#x585E;&#x63A5;&#x6536;Socket; &#x5BF9;Socket&#x5904;&#x7406;&#x4E5F;&#x662F;&#x963B;&#x585E;&#x7684;</li>
</ul>
<pre class="language-"><code class="lang-java">socket <span class="token operator">=</span> serverSocketFactory<span class="token punctuation">.</span><span class="token function">acceptSocket</span><span class="token punctuation">(</span>serverSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>Process socket &#x5F00;&#x542F;&#x65B0;&#x7EBF;&#x7A0B;&#x5904;&#x7406;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
    * Process a new connection from a new client. Wraps the socket so
    * keep-alive and other attributes can be tracked and then passes the socket
    * to the executor for processing.
    *
    * @param socket    The socket associated with the client.
    *
    * @return          &lt;code&gt;true&lt;/code&gt; if the socket is passed to the
    *                  executor, &lt;code&gt;false&lt;/code&gt; if something went wrong or
    *                  if the endpoint is shutting down. Returning
    *                  &lt;code&gt;false&lt;/code&gt; is an indication to close the socket
    *                  immediately.
    */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">processSocket</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Process the request from this socket</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">SocketWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Socket</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SocketWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Socket</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">setKeepAliveLeft</span><span class="token punctuation">(</span><span class="token function">getMaxKeepAliveRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">setSecure</span><span class="token punctuation">(</span><span class="token function">isSSLEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// During shutdown, executor may be null - avoid NPE</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SocketProcessor</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RejectedExecutionException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Socket processing request was rejected for:&quot;</span><span class="token operator">+</span>socket<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// This means we got an OOM or similar creating a thread, or that</span>
        <span class="token comment">// the pool and its queue are full</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint.process.fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="bio&#x6A21;&#x578B;">BIO&#x6A21;&#x578B;</h5>
<p><img src="imgs/tomcat_02.jpg" alt=""></p>
<p><code>JIoEndpoint</code>&#x7EF4;&#x62A4;&#x4E86;Acceptor&#x548C;Worker&#xFF1A;Acceptor&#x63A5;&#x6536;socket&#xFF0C;&#x7136;&#x540E;&#x4ECE;Worker&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x627E;&#x51FA;&#x7A7A;&#x95F2;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x7406;socket&#xFF0C;&#x5982;&#x679C;worker&#x7EBF;&#x7A0B;&#x6C60;&#x6CA1;&#x6709;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x5219;Acceptor&#x5C06;&#x963B;&#x585E;&#x3002;</p>
<ol>
<li>&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;Coresize&#xFF1A;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6267;&#x884C;</li>
<li>&#x5927;&#x4E8E;CoreSize&#xFF1A;&#x52A0;&#x5165;&#x961F;&#x5217;</li>
<li>&#x961F;&#x5217;&#x6EE1;&#x4E14;&#x5C0F;&#x4E8E;maxSize&#xFF1A;&#x6709;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF1B;&#x5982;&#x679C;&#x5927;&#x4E8E;maxSize&#x5219;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</li>
</ol>
<h6 id="&#x9644;&#xFF1A;&#x9650;&#x6D41;&#x7EC4;&#x4EF6;limitlatch">&#x9644;&#xFF1A;&#x9650;&#x6D41;&#x7EC4;&#x4EF6;LimitLatch</h6>
<p>LimitLatch&#x7EC4;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x7EC4;&#x4EF6;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x4E0D;&#x8BA9;Tomcat&#x7EC4;&#x4EF6;&#x88AB;&#x5927;&#x6D41;&#x91CF;&#x51B2;&#x57AE;&#x3002;LimitLatch&#x901A;&#x8FC7;AQS&#x673A;&#x5236;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x7EC4;&#x4EF6;&#x542F;&#x52A8;&#x65F6;&#x5148;&#x521D;&#x59CB;&#x5316;&#x540C;&#x6B65;&#x5668;&#x7684;&#x6700;&#x5927;&#x9650;&#x5236;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x6BCF;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x5C31;&#x5C06;&#x8BA1;&#x6570;&#x53D8;&#x91CF;&#x7D2F;&#x52A0;1&#xFF0C;&#x6BCF;&#x5173;&#x95ED;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x5C06;&#x8BA1;&#x6570;&#x53D8;&#x91CF;&#x51CF;1&#x3002;&#x5F53;&#x8FDE;&#x63A5;&#x6570;&#x8FBE;&#x5230;&#x6700;&#x5927;&#x503C;&#x65F6;&#xFF0C;Acceptor&#x7EBF;&#x7A0B;&#x5C31;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#xFF0C;&#x4E0D;&#x518D;accept&#x65B0;&#x7684;socket&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x9700;&#x8981;&#x989D;&#x5916;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x5F53;&#x5230;&#x8FBE;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x65F6;&#xFF08;&#x5DF2;&#x7ECF;LimitLatch&#x7EC4;&#x4EF6;&#x6700;&#x5927;&#x503C;&#xFF0C;acceptor&#x7EC4;&#x4EF6;&#x963B;&#x585E;&#x4E86;&#xFF09;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x8FD8;&#x662F;&#x4F1A;&#x7EE7;&#x7EED;&#x63A5;&#x6536;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x5C06;&#x8BF7;&#x6C42;&#x653E;&#x5165;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x4E2D;&#xFF08;backlog&#x961F;&#x5217;&#xFF09;&#x3002;&#x8FD9;&#x4E2A;&#x961F;&#x5217;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x957F;&#x5EA6;&#x7684;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F;100&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;server.xml&#x7684;Connector&#x8282;&#x70B9;&#x7684;acceptCount&#x5C5E;&#x6027;&#x914D;&#x7F6E;&#x3002;&#x5047;&#x5982;&#x5728;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6709;&#x5927;&#x91CF;&#x8BF7;&#x6C42;&#x8FC7;&#x6765;&#xFF0C;&#x8FDE;backlog&#x961F;&#x5217;&#x90FD;&#x653E;&#x6EE1;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5C06;&#x62D2;&#x7EDD;&#x63A5;&#x6536;&#x540E;&#x7EED;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD4;&#x56DE;&#x201C;connection refused&#x201D;&#x3002;</p>
<p>&#x5728;BIO&#x6A21;&#x5F0F;&#x4E2D;&#xFF0C;LimitLatch&#x7EC4;&#x4EF6;&#x652F;&#x6301;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x662F;&#x901A;&#x8FC7;server.xml&#x7684;Connector&#x8282;&#x70B9;&#x7684;maxConnections&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6210;-1&#xFF0C;&#x5219;&#x8868;&#x793A;&#x4E0D;&#x9650;&#x5236;&#x3002;</p>
<h6 id="&#x9644;&#xFF1A;standardthreadexecutortomcat-70105&#x57FA;&#x4E8E;jdkthreadpoolexecutor">&#x9644;&#xFF1A;StandardThreadExecutor(Tomcat 7.0.105,&#x57FA;&#x4E8E;JDK<code>ThreadPoolExecutor</code>)</h6>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">RejectedExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina</span><span class="token punctuation">.</span><span class="token class-name">Executor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina</span><span class="token punctuation">.</span><span class="token class-name">LifecycleException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina</span><span class="token punctuation">.</span><span class="token class-name">LifecycleState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">LifecycleMBeanBase</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads</span><span class="token punctuation">.</span><span class="token class-name">ResizableExecutor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads</span><span class="token punctuation">.</span><span class="token class-name">TaskQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads</span><span class="token punctuation">.</span><span class="token class-name">TaskThreadFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads</span><span class="token punctuation">.</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StandardThreadExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">LifecycleMBeanBase</span>
        <span class="token keyword">implements</span> <span class="token class-name">Executor</span><span class="token punctuation">,</span> <span class="token class-name">ResizableExecutor</span> <span class="token punctuation">{</span>

    <span class="token comment">// ---------------------------------------------- Properties</span>
    <span class="token comment">/**
     * Default thread priority
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> threadPriority <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span>NORM_PRIORITY<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Run threads in daemon or non-daemon state
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> daemon <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Default name prefix for the thread name
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> namePrefix <span class="token operator">=</span> <span class="token string">&quot;tomcat-exec-&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * max number of threads
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> maxThreads <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * min number of threads
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> minSpareThreads <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * idle time in milliseconds
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> maxIdleTime <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The executor we use for this component
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * the name of this thread pool
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/**
     * prestart threads?
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> prestartminSpareThreads <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The maximum number of elements that can queue up before we reject them
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> maxQueueSize <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>

    <span class="token comment">/**
     * After a context is stopped, threads in the pool are renewed. To avoid
     * renewing all threads at the same time, this delay is observed between 2
     * threads being renewed.
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">long</span> threadRenewalDelay <span class="token operator">=</span>
        org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>DEFAULT_THREAD_RENEWAL_DELAY<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">TaskQueue</span> taskqueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// ---------------------------------------------- Constructors</span>
    <span class="token keyword">public</span> <span class="token class-name">StandardThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//empty constructor for the digester</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ---------------------------------------------- Public Methods</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * Start the component and implement the requirements
     * of {@link org.apache.catalina.util.LifecycleBase#startInternal()}.
     *
     * @exception LifecycleException if this component detects a fatal error
     *  that prevents this component from being used
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{</span>

        taskqueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span>maxQueueSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskThreadFactory</span> tf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskThreadFactory</span><span class="token punctuation">(</span>namePrefix<span class="token punctuation">,</span>daemon<span class="token punctuation">,</span><span class="token function">getThreadPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token function">getMinSpareThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getMaxThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> maxIdleTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>taskqueue<span class="token punctuation">,</span> tf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setThreadRenewalDelay</span><span class="token punctuation">(</span>threadRenewalDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prestartminSpareThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">prestartAllCoreThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        taskqueue<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>STARTING<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * Stop the component and implement the requirements
     * of {@link org.apache.catalina.util.LifecycleBase#stopInternal()}.
     *
     * @exception LifecycleException if this component detects a fatal error
     *  that needs to be reported
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">stopInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{</span>

        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>STOPPING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> executor <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> executor<span class="token punctuation">.</span><span class="token function">shutdownNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        taskqueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">destroyInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">destroyInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> executor <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span>timeout<span class="token punctuation">,</span>unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;StandardThreadExecutor not started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> executor <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RejectedExecutionException</span> rx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//there could have been contention around the queue</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token class-name">TaskQueue</span><span class="token punctuation">)</span> executor<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RejectedExecutionException</span><span class="token punctuation">(</span><span class="token string">&quot;Work queue full.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;StandardThreadPool not started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextStopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">contextStopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getThreadPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> threadPriority<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> daemon<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNamePrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> namePrefix<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxIdleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> maxIdleTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> maxThreads<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMinSpareThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> minSpareThreads<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isPrestartminSpareThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> prestartminSpareThreads<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setThreadPriority</span><span class="token punctuation">(</span><span class="token keyword">int</span> threadPriority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadPriority <span class="token operator">=</span> threadPriority<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> daemon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>daemon <span class="token operator">=</span> daemon<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNamePrefix</span><span class="token punctuation">(</span><span class="token class-name">String</span> namePrefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>namePrefix <span class="token operator">=</span> namePrefix<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxIdleTime</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxIdleTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxIdleTime <span class="token operator">=</span> maxIdleTime<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">setKeepAliveTime</span><span class="token punctuation">(</span>maxIdleTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxThreads</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxThreads <span class="token operator">=</span> maxThreads<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>maxThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMinSpareThreads</span><span class="token punctuation">(</span><span class="token keyword">int</span> minSpareThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minSpareThreads <span class="token operator">=</span> minSpareThreads<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span>minSpareThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrestartminSpareThreads</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> prestartminSpareThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>prestartminSpareThreads <span class="token operator">=</span> prestartminSpareThreads<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxQueueSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxQueueSize <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxQueueSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> maxQueueSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getThreadRenewalDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> threadRenewalDelay<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setThreadRenewalDelay</span><span class="token punctuation">(</span><span class="token keyword">long</span> threadRenewalDelay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadRenewalDelay <span class="token operator">=</span> threadRenewalDelay<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">setThreadRenewalDelay</span><span class="token punctuation">(</span>threadRenewalDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Statistics from the thread pool</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getActiveCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getActiveCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCompletedTaskCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getCompletedTaskCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCorePoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getCorePoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getLargestPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getLargestPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getQueueSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">resizePool</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span> <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>maximumPoolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">resizeQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getDomainInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// No way to navigate to Engine. Needs to have domain set.</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getObjectNameKeyProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;type=Executor,name=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        name<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="orgapachecoyotehttp11http11nioprotocol">org.apache.coyote.http11.Http11NioProtocol</h4>
<h5 id="nioendpoint">NioEndpoint</h5>
<h5 id="nioendpoint&#x7684;&#x521D;&#x59CB;&#x5316;">NioEndpoint&#x7684;&#x521D;&#x59CB;&#x5316;</h5>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
    * Initialize the endpoint.
    */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;ServerSocketChannel</span>
    serverSock <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socketProperties<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span>serverSock<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InetSocketAddress</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">?</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;</span>
    serverSock<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token function">getBacklog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x8BBE;&#x7F6E;&#x6210;&#x963B;&#x585E;&#x65B9;&#x5F0F;</span>
    serverSock<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//mimic APR behavior</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getSocketProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSoTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverSock<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSoTimeout</span><span class="token punctuation">(</span><span class="token function">getSocketProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSoTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x521D;&#x59CB;&#x5316;acceptor&#x7EBF;&#x7A0B;&#x6570;</span>
    <span class="token comment">// Initialize thread count defaults for acceptor, poller</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>acceptorThreadCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// FIXME: Doesn&apos;t seem to work that well with multiple accept threads</span>
        acceptorThreadCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// &#x521D;&#x59CB;&#x5316;poller&#x7EBF;&#x7A0B;&#x6570;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pollerThreadCount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//minimum one poller thread</span>
        pollerThreadCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    stopLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>pollerThreadCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Initialize SSL if needed</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSSLEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SSLUtil</span> sslUtil <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">getSslImplementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSSLUtil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sslContext <span class="token operator">=</span> sslUtil<span class="token punctuation">.</span><span class="token function">createSSLContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sslContext<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">wrap</span><span class="token punctuation">(</span>sslUtil<span class="token punctuation">.</span><span class="token function">getKeyManagers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                sslUtil<span class="token punctuation">.</span><span class="token function">getTrustManagers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SSLSessionContext</span> sessionContext <span class="token operator">=</span>
            sslContext<span class="token punctuation">.</span><span class="token function">getServerSessionContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sslUtil<span class="token punctuation">.</span><span class="token function">configureSessionContext</span><span class="token punctuation">(</span>sessionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Determine which cipher suites and protocols to enable</span>
        enabledCiphers <span class="token operator">=</span> sslUtil<span class="token punctuation">.</span><span class="token function">getEnableableCiphers</span><span class="token punctuation">(</span>sslContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        enabledProtocols <span class="token operator">=</span> sslUtil<span class="token punctuation">.</span><span class="token function">getEnableableProtocols</span><span class="token punctuation">(</span>sslContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>oomParachute<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">reclaimParachute</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x5F00;&#x542F;NioSelectorPool</span>
    selectorPool<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="nioendpoint-acceptor">NioEndpoint Acceptor</h5>
<pre class="language-"><code class="lang-java"><span class="token comment">// --------------------------------------------------- Acceptor Inner Class</span>
<span class="token comment">/**
    * The background thread that listens for incoming TCP/IP connections and
    * hands them off to an appropriate processor.
    */</span>
<span class="token keyword">protected</span> <span class="token keyword">class</span> <span class="token class-name">Acceptor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEndpoint</span><span class="token punctuation">.</span><span class="token class-name">Acceptor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> errorDelay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// Loop until we receive a shutdown command</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// Loop if endpoint is paused</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>paused <span class="token operator">&amp;&amp;</span> running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                state <span class="token operator">=</span> <span class="token class-name">AcceptorState</span><span class="token punctuation">.</span>PAUSED<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Ignore</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            state <span class="token operator">=</span> <span class="token class-name">AcceptorState</span><span class="token punctuation">.</span>RUNNING<span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//if we have reached max connections, wait</span>
                <span class="token function">countUpOrAwaitConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">SocketChannel</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// &#x63A5;&#x6536;&#x8BF7;&#x6C42;</span>
                    <span class="token comment">// Accept the next incoming connection from the server</span>
                    <span class="token comment">// socket</span>
                    socket <span class="token operator">=</span> serverSock<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ioe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//we didn&apos;t get a socket</span>
                    <span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Introduce delay if necessary</span>
                    errorDelay <span class="token operator">=</span> <span class="token function">handleExceptionWithDelay</span><span class="token punctuation">(</span>errorDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// re-throw</span>
                    <span class="token keyword">throw</span> ioe<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// Successful accept, reset the error delay</span>
                errorDelay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token comment">// setSocketOptions() will add channel to the poller</span>
                <span class="token comment">// if successful</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>running <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>paused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// setSocketOptions() &#x628A;socket channel &#x52A0;&#x5230; poller &#x4E2D;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">setSocketOptions</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">closeSocket</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">closeSocket</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketTimeoutException</span> sx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Ignore: Normal condition</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint.accept.fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OutOfMemoryError</span> oom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    oomParachuteData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token function">releaseCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> oom<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">Throwable</span> oomt <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>oomParachuteMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            oomt<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> letsHopeWeDontGetHere<span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>letsHopeWeDontGetHere<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> letsHopeWeDontGetHere<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>letsHopeWeDontGetHere<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint.accept.fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        state <span class="token operator">=</span> <span class="token class-name">AcceptorState</span><span class="token punctuation">.</span>ENDED<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>&#x8BBE;&#x7F6E;&#x975E;&#x963B;&#x585E;</li>
<li>&#x65B0;&#x7684;SocketChannel&#x540E;&#x4F1A;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;<code>OP_REGISTER</code>&#x7C7B;&#x578B;&#x7684;<code>PollerEvent</code>&#x4E8B;&#x4EF6;&#x5E76;&#x653E;&#x5230;<code>Poller.events</code>&#x961F;&#x5217;&#x4E2D;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
    * Process the specified connection.
    */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">setSocketOptions</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Process the connection</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//disable blocking, APR style, we are gonna be polling it</span>
        socket<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> sock <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socketProperties<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">NioChannel</span> channel <span class="token operator">=</span> nioChannels<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> channel <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// SSL setup</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sslContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">SSLEngine</span> engine <span class="token operator">=</span> <span class="token function">createSSLEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> appbufsize <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">NioBufferHandler</span> bufhandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioBufferHandler</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>appbufsize<span class="token punctuation">,</span>socketProperties<span class="token punctuation">.</span><span class="token function">getAppReadBufSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                    <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>appbufsize<span class="token punctuation">,</span>socketProperties<span class="token punctuation">.</span><span class="token function">getAppWriteBufSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                    socketProperties<span class="token punctuation">.</span><span class="token function">getDirectBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureNioChannel</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> engine<span class="token punctuation">,</span> bufhandler<span class="token punctuation">,</span> selectorPool<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// normal tcp setup</span>
                <span class="token class-name">NioBufferHandler</span> bufhandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioBufferHandler</span><span class="token punctuation">(</span>socketProperties<span class="token punctuation">.</span><span class="token function">getAppReadBufSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                    socketProperties<span class="token punctuation">.</span><span class="token function">getAppWriteBufSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                    socketProperties<span class="token punctuation">.</span><span class="token function">getDirectBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioChannel</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> bufhandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            channel<span class="token punctuation">.</span><span class="token function">setIOChannel</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> channel <span class="token keyword">instanceof</span> <span class="token class-name">SecureNioChannel</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">SSLEngine</span> engine <span class="token operator">=</span> <span class="token function">createSSLEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SecureNioChannel</span><span class="token punctuation">)</span>channel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                channel<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// &#x6CE8;&#x518C;NioChannel&#x5BF9;&#x8C61;</span>
        <span class="token function">getPoller0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ExceptionUtils</span><span class="token punctuation">.</span><span class="token function">handleThrowable</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Tell to close the socket</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">NioChannel</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">setPoller</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">KeyAttachment</span> key <span class="token operator">=</span> keyCache<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">KeyAttachment</span> ka <span class="token operator">=</span> key<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">?</span>key<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">KeyAttachment</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ka<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>socket<span class="token punctuation">,</span><span class="token function">getSocketProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSoTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ka<span class="token punctuation">.</span><span class="token function">setKeepAliveLeft</span><span class="token punctuation">(</span><span class="token class-name">NioEndpoint</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMaxKeepAliveRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ka<span class="token punctuation">.</span><span class="token function">setSecure</span><span class="token punctuation">(</span><span class="token function">isSSLEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PollerEvent</span> r <span class="token operator">=</span> eventCache<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ka<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//this is what OP_REGISTER turns into.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> r<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PollerEvent</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span>ka<span class="token punctuation">,</span>OP_REGISTER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> r<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span>ka<span class="token punctuation">,</span>OP_REGISTER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x6DFB;&#x52A0;`PollerEvent`</span>
    <span class="token function">addEvent</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><code>Poller</code>&#x7EBF;&#x7A0B;&#x4F1A;&#x4ECE;<code>Poller.events</code>&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;<code>PollerEvent</code>&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x8FD0;&#x884C;<code>PollerEvent.run()</code>&#x65B9;&#x6CD5;&#x3002;&#x5728;<code>PollerEvent.run()</code>&#x65B9;&#x6CD5;&#x4E2D;&#x53D1;&#x73B0;&#x662F;<code>OP_REGISTER</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x5219;&#x4F1A;&#x5728;<code>Poller.selector</code>&#x4E0A;&#x6CE8;&#x518C;<code>SocketChannel</code>&#x5BF9;&#x8C61;&#x7684;<code>OP_READ</code>&#x5C31;&#x7EEA;&#x4E8B;&#x4EF6;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> interestOps <span class="token operator">==</span> OP_REGISTER <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            socket<span class="token punctuation">.</span><span class="token function">getIOChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getPoller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getIOChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getPoller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// The key was cancelled (e.g. due to socket closure)</span>
                <span class="token comment">// and removed from the selector while it was being</span>
                <span class="token comment">// processed. Count down the connections at this point</span>
                <span class="token comment">// since it won&apos;t have been counted down when the socket</span>
                <span class="token comment">// closed.</span>
                socket<span class="token punctuation">.</span><span class="token function">getPoller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">countDownConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">KeyAttachment</span> att <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">KeyAttachment</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> att<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//handle callback flag</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>att<span class="token punctuation">.</span><span class="token function">isComet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>interestOps <span class="token operator">&amp;</span> OP_CALLBACK<span class="token punctuation">)</span> <span class="token operator">==</span> OP_CALLBACK <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        att<span class="token punctuation">.</span><span class="token function">setCometNotify</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        att<span class="token punctuation">.</span><span class="token function">setCometNotify</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    interestOps <span class="token operator">=</span> <span class="token punctuation">(</span>interestOps <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>OP_CALLBACK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//remove the callback flag</span>
                    att<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//to prevent timeout</span>
                    <span class="token comment">//we are registering the key to start with, reset the fairness counter.</span>
                    <span class="token keyword">int</span> ops <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span> interestOps<span class="token punctuation">;</span>
                    att<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>ops<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>ops<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    socket<span class="token punctuation">.</span><span class="token function">getPoller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cancelledKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">SocketStatus</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CancelledKeyException</span> ckx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                socket<span class="token punctuation">.</span><span class="token function">getPoller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cancelledKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">SocketStatus</span><span class="token punctuation">.</span>DISCONNECT<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token comment">//end if</span>
<span class="token punctuation">}</span><span class="token comment">//run</span>
</code></pre>
<h5 id="&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;nio&#xFF08;none-blocking-io&#xFF09;">&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;NIO&#xFF08;None Blocking IO&#xFF09;</h5>
<ul>
<li>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x4E0D;&#x65AD;&#x7684;&#x8FDB;&#x884C; I/O &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x8F6E;&#x8BE2;&#x6570;&#x636E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x7EE7;&#x7EED;&#x8F6E;&#x8BE2;&#xFF0C;&#x76F4;&#x5230;&#x5B8C;&#x6210;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E3A;&#x6B62;&#x3002;</li>
</ul>
<p>&#x4F18;&#x70B9;&#xFF1A;&#x6BCF;&#x6B21;&#x53D1;&#x8D77;&#x7684; IO &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5728;&#x5185;&#x6838;&#x7684;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x3002;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x5B9E;&#x65F6;&#x6027;&#x8F83;&#x597D;
&#x7F3A;&#x70B9;&#xFF1A;&#x9700;&#x8981;&#x4E0D;&#x65AD;&#x7684;&#x91CD;&#x590D;&#x53D1;&#x8D77;IO&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x79CD;&#x4E0D;&#x65AD;&#x7684;&#x8F6E;&#x8BE2;&#xFF0C;&#x5C06;&#x4F1A;&#x4E0D;&#x65AD;&#x5730;&#x8BE2;&#x95EE;&#x5185;&#x6838;&#xFF0C;&#x8FD9;&#x5C06;&#x5360;&#x7528;&#x5927;&#x91CF;&#x7684; CPU &#x65F6;&#x95F4;&#xFF0C;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x5229;&#x7528;&#x7387;&#x8F83;&#x4F4E;&#x3002;</p>
<h5 id="&#x8865;&#x5145;&#xFF1A;&#x5982;&#x4F55;&#x907F;&#x514D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;nio&#x6A21;&#x578B;&#x4E2D;&#x8F6E;&#x8BE2;&#x7B49;&#x5F85;&#x7684;&#x95EE;&#x9898;&#x5462;&#xFF1F;">&#x8865;&#x5145;&#xFF1A;&#x5982;&#x4F55;&#x907F;&#x514D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;NIO&#x6A21;&#x578B;&#x4E2D;&#x8F6E;&#x8BE2;&#x7B49;&#x5F85;&#x7684;&#x95EE;&#x9898;&#x5462;&#xFF1F;</h5>
<p>&#x5982;&#x4F55;&#x907F;&#x514D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;NIO&#x6A21;&#x578B;&#x4E2D;&#x8F6E;&#x8BE2;&#x7B49;&#x5F85;&#x7684;&#x95EE;&#x9898;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x662F;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x6A21;&#x578B;&#x3002;</p>
<p>IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x6A21;&#x578B;&#xFF0C;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x76D1;&#x89C6;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x4E00;&#x65E6;&#x67D0;&#x4E2A;&#x63CF;&#x8FF0;&#x7B26;&#x5C31;&#x7EEA;&#xFF08;&#x4E00;&#x822C;&#x662F;&#x5185;&#x6838;&#x7F13;&#x51B2;&#x533A;&#x53EF;&#x8BFB;/&#x53EF;&#x5199;&#xFF09;&#xFF0C;&#x5185;&#x6838;kernel&#x80FD;&#x591F;&#x901A;&#x77E5;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;IO&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x76EE;&#x524D;&#x652F;&#x6301;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x6709; select&#xFF0C;epoll&#x7B49;&#x7B49;&#x3002;select&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x76EE;&#x524D;&#x51E0;&#x4E4E;&#x5728;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x90FD;&#x6709;&#x652F;&#x6301;&#xFF0C;&#x5177;&#x6709;&#x826F;&#x597D;&#x8DE8;&#x5E73;&#x53F0;&#x7279;&#x6027;&#x3002;epoll&#x662F;&#x5728;linux 2.6&#x5185;&#x6838;&#x4E2D;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x662F;select&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;linux&#x589E;&#x5F3A;&#x7248;&#x672C;&#x3002;</p>
<h6 id="&#x590D;&#x4E60;&#x963B;&#x585E;&#x975E;&#x963B;&#x585E;&#xFF0C;&#x540C;&#x6B65;&#x5F02;&#x6B65;&#x7684;&#x6982;&#x5FF5;">&#x590D;&#x4E60;&#x963B;&#x585E;/&#x975E;&#x963B;&#x585E;&#xFF0C;&#x540C;&#x6B65;/&#x5F02;&#x6B65;&#x7684;&#x6982;&#x5FF5;</h6>
<ul>
<li>&#x963B;&#x585E;&#x4E0E;&#x975E;&#x963B;&#x585E;(&#x7B49;&#x5F85;IO&#x65F6;&#x7684;&#x72B6;&#x6001;)</li>
</ul>
<p>&#x51FD;&#x6570;&#x6216;&#x65B9;&#x6CD5;&#xFF08;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x5185;&#x6838;IO&#x64CD;&#x4F5C;&#xFF09;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ol>
<li>&#x963B;&#x585E;&#x662F;&#x6307;IO&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x5F7B;&#x5E95;&#x5B8C;&#x6210;&#x540E;&#x624D;&#x8FD4;&#x56DE;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;</li>
<li><p>&#x975E;&#x963B;&#x585E;&#x662F;&#x6307;IO&#x64CD;&#x4F5C;&#x88AB;&#x8C03;&#x7528;&#x540E;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x503C;&#xFF0C;&#x65E0;&#x9700;&#x7B49;&#x5230;IO&#x64CD;&#x4F5C;&#x5F7B;&#x5E95;&#x5B8C;&#x6210;&#x3002;</p>
</li>
<li><p>&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#xFF08;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x4E0E;&#x5185;&#x6838;&#x7684;&#x6D88;&#x606F;&#x4EA4;&#x4E92;&#x65B9;&#x5F0F;&#xFF09;</p>
</li>
<li><p>&#x540C;&#x6B65;&#x6307;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x53D1;&#x8D77;IO&#x8BF7;&#x6C42;&#x540E;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x6216;&#x8005;<strong>&#x8F6E;&#x8BE2;&#x5185;&#x6838;IO&#x64CD;&#x4F5C;</strong>&#x5B8C;&#x6210;&#x540E;&#x624D;&#x80FD;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF1B;&#x540C;&#x6B65;&#x6709;&#x963B;&#x585E;&#xFF0C;&#x975E;&#x963B;&#x585E;&#x4E4B;&#x5206;</p>
</li>
<li><p>&#x5F02;&#x6B65;&#x662F;&#x6307;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x53D1;&#x8D77;IO&#x8BF7;&#x6C42;&#x540E;&#x4ECD;&#x7136;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x5F53;<strong>&#x5185;&#x6838;IO&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x901A;&#x77E5;&#x7528;&#x6237;&#x7EBF;&#x7A0B;</strong>&#xFF0C;&#x6216;&#x8005;&#x8C03;&#x7528;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x6CE8;&#x518C;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x5F02;&#x6B65;&#x4E00;&#x5B9A;&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#xFF08;&#x5185;&#x6838;&#x4F1A;&#x901A;&#x8FC7;&#x51FD;&#x6570;&#x56DE;&#x8C03;&#x6216;&#x8005;&#x4FE1;&#x53F7;&#x673A;&#x5236;&#x901A;&#x77E5;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#xFF1B;&#x7C7B;&#x4F3C;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF09;</p>
</li>
</ol>
<footer class="page-footer"><span class="copyright">Copyright @doctording all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;
2020-07-20 21:02:24
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="rpc.html" class="navigation navigation-prev " aria-label="Previous page: rpc">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="distribute.html" class="navigation navigation-next " aria-label="Next page: 分布式">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"tomcat","layout":"page","date":"2020-07-12 00:00","level":"1.10.4","depth":2,"next":{"title":"分布式","level":"1.10.5","depth":2,"path":"content/distributed_design/distribute.md","ref":"./content/distributed_design/distribute.md","articles":[]},"previous":{"title":"rpc","level":"1.10.3","depth":2,"path":"content/distributed_design/rpc.md","ref":"./content/distributed_design/rpc.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","-lunr","-search","-sharing","ace","codeblock-filename","search-plus","sectionx","splitter","tbfed-pagefooter","expandable-chapters","back-to-top-button","code","uml","page-treeview"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright @doctording","modify_label":"该文件修改时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"copyright":"Copyright @doctording","minHeaderCount":"2","minHeaderDeep":"2"},"prism":{},"ace":{},"splitter":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"sectionx":{},"uml":{"format":"svg"},"codeblock-filename":{},"back-to-top-button":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","author":"doctording","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"spring-note","language":"zh-hans","gitbook":"*","description":"Java开发"},"file":{"path":"content/distributed_design/tomcat.md","mtime":"2020-07-20T13:02:24.179Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-07-20T15:52:54.318Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

