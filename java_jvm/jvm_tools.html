<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/tango.css">
    <link rel="shortcut icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>JVM命令工具(jstack,jmap,jcmd...) - 剑指Offer</title>
    <meta name="keywords" content="algorithm，python"/>
    <meta name="description" content="for python and algorithm"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/sword_at_offer/">Home</a>&nbsp;&#187;&nbsp;<a href="/sword_at_offer/#java_jvm">java_jvm</a>&nbsp;&#187;&nbsp;JVM命令工具(jstack,jmap,jcmd...)
    <span class="updated">Page Updated&nbsp;
      2019-02-15 00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">JVM命令工具(jstack,jmap,jcmd...)</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#java">Java自带的各类型命令工具</a><ul>
<li><a href="#jps">jps</a></li>
<li><a href="#jstat">jstat</a></li>
<li><a href="#jmap">jmap</a></li>
<li><a href="#jstack">jstack</a></li>
<li><a href="#jcmd">jcmd</a><ul>
<li><a href="#native-memory-trackingnmt">Native Memory Tracking(简称:NMT) 分析</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="java">Java自带的各类型命令工具</h1>
<table>
<thead>
<tr>
<th>名称</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>jps</td>
<td>JVM Process Status Tool, 显示指定系统内所有的HotSpot虚拟机进程</td>
</tr>
<tr>
<td>jstat</td>
<td>JVM Statistics Monitoring Tool, 用于收集HotSpot虚拟机各方面的运行数据</td>
</tr>
<tr>
<td>jinfo</td>
<td>Configuration Info for Java, 显示虚拟机配置信息</td>
</tr>
<tr>
<td>jmap</td>
<td>Memory Map for Java, 生成虚拟机的内存转储快照(heapdump文件)</td>
</tr>
<tr>
<td>jhat</td>
<td>JVM Heap Dump Brower, 用于分心heapdump文件，它会建立一个HTTP/HTML服务器, 让用户可以在浏览器上查看分析结果</td>
</tr>
<tr>
<td>jstack</td>
<td>Stack Trace for Java, 显示虚拟机的线程快照</td>
</tr>
<tr>
<td>jcmd</td>
<td>可以用它来查看Java进程，导出堆、线程信息、执行GC，还可以进行采样分析的一个多功能工具</td>
</tr>
</tbody>
</table>
<h2 id="jps">jps</h2>
<div class="hlcode"><pre><span class="nx">mubi</span><span class="err">@</span><span class="nx">mubideMacBook</span><span class="o">-</span><span class="nx">Pro</span> <span class="nx">webapps</span> <span class="nx">$</span> <span class="nx">jps</span> <span class="o">--</span><span class="nx">help</span>
<span class="nx">illegal</span> <span class="nx">argument</span><span class="o">:</span> <span class="o">--</span><span class="nx">help</span>
<span class="nx">usage</span><span class="o">:</span> <span class="nx">jps</span> <span class="p">[</span><span class="o">-</span><span class="nx">help</span><span class="p">]</span>
       <span class="nx">jps</span> <span class="p">[</span><span class="o">-</span><span class="nx">q</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">mlvV</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="nx">hostid</span><span class="o">&gt;</span><span class="p">]</span>

<span class="nx">Definitions</span><span class="o">:</span>
    <span class="o">&lt;</span><span class="nx">hostid</span><span class="o">&gt;:</span>      <span class="o">&lt;</span><span class="nx">hostname</span><span class="o">&gt;</span><span class="p">[</span><span class="o">:&lt;</span><span class="nx">port</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>


<ul>
<li>参数</li>
</ul>
<p>-q：只输出进程 ID<br />
-m：输出传入 main 方法的参数<br />
-l：输出完全的包名，应用主类名，jar的完全路径名<br />
-v：输出jvm参数<br />
-V：输出通过flag文件传递到JVM中的参数</p>
<p>这些进程的本地虚拟机唯一ID(Local VIrtual Machine Identifier, LVMID), 对于本地虚拟机进程来说，LVMID与操作系统的进程ID(Process Identifier, PID)是一致的</p>
<h2 id="jstat">jstat</h2>
<div class="hlcode"><pre><span class="nx">mubi</span><span class="err">@</span><span class="nx">mubideMacBook</span><span class="o">-</span><span class="nx">Pro</span> <span class="nx">webapps</span> <span class="nx">$</span> <span class="nx">jstat</span> <span class="o">--</span><span class="nx">help</span>
<span class="nx">invalid</span> <span class="nx">argument</span> <span class="nx">count</span>
<span class="nx">Usage</span><span class="o">:</span> <span class="nx">jstat</span> <span class="o">-</span><span class="nx">help</span><span class="o">|-</span><span class="nx">options</span>
       <span class="nx">jstat</span> <span class="o">-&lt;</span><span class="nx">option</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">-</span><span class="nx">t</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">h</span><span class="o">&lt;</span><span class="nx">lines</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">&lt;</span><span class="nx">vmid</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="nx">interval</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">&gt;</span><span class="p">]]</span>

<span class="nx">Definitions</span><span class="o">:</span>
  <span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;</span>      <span class="nx">An</span> <span class="nx">option</span> <span class="nx">reported</span> <span class="nx">by</span> <span class="nx">the</span> <span class="o">-</span><span class="nx">options</span> <span class="nx">option</span>
  <span class="o">&lt;</span><span class="nx">vmid</span><span class="o">&gt;</span>        <span class="nx">Virtual</span> <span class="nx">Machine</span> <span class="nx">Identifier</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">vmid</span> <span class="nx">takes</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">form</span><span class="o">:</span>
                     <span class="o">&lt;</span><span class="nx">lvmid</span><span class="o">&gt;</span><span class="p">[</span><span class="err">@</span><span class="o">&lt;</span><span class="nx">hostname</span><span class="o">&gt;</span><span class="p">[</span><span class="o">:&lt;</span><span class="nx">port</span><span class="o">&gt;</span><span class="p">]]</span>
                <span class="nx">Where</span> <span class="o">&lt;</span><span class="nx">lvmid</span><span class="o">&gt;</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">local</span> <span class="nx">vm</span> <span class="nx">identifier</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">target</span>
                <span class="nx">Java</span> <span class="nx">virtual</span> <span class="nx">machine</span><span class="p">,</span> <span class="nx">typically</span> <span class="nx">a</span> <span class="nx">process</span> <span class="nx">id</span><span class="p">;</span> <span class="o">&lt;</span><span class="nx">hostname</span><span class="o">&gt;</span> <span class="nx">is</span>
                <span class="nx">the</span> <span class="nx">name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">host</span> <span class="nx">running</span> <span class="nx">the</span> <span class="nx">target</span> <span class="nx">Java</span> <span class="nx">virtual</span> <span class="nx">machine</span><span class="p">;</span>
                <span class="nx">and</span> <span class="o">&lt;</span><span class="nx">port</span><span class="o">&gt;</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">port</span> <span class="nx">number</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">rmiregistry</span> <span class="nx">on</span> <span class="nx">the</span>
                <span class="nx">target</span> <span class="nx">host</span><span class="p">.</span> <span class="nx">See</span> <span class="nx">the</span> <span class="nx">jvmstat</span> <span class="nx">documentation</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">more</span> <span class="nx">complete</span>
                <span class="nx">description</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Virtual</span> <span class="nx">Machine</span> <span class="nx">Identifier</span><span class="p">.</span>
  <span class="o">&lt;</span><span class="nx">lines</span><span class="o">&gt;</span>       <span class="nb">Number</span> <span class="nx">of</span> <span class="nx">samples</span> <span class="nx">between</span> <span class="nx">header</span> <span class="nx">lines</span><span class="p">.</span>
  <span class="o">&lt;</span><span class="nx">interval</span><span class="o">&gt;</span>    <span class="nx">Sampling</span> <span class="nx">interval</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">following</span> <span class="nx">forms</span> <span class="nx">are</span> <span class="nx">allowed</span><span class="o">:</span>
                    <span class="o">&lt;</span><span class="nx">n</span><span class="o">&gt;</span><span class="p">[</span><span class="s2">&quot;ms&quot;</span><span class="o">|</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>
                <span class="nx">Where</span> <span class="o">&lt;</span><span class="nx">n</span><span class="o">&gt;</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">integer</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">suffix</span> <span class="nx">specifies</span> <span class="nx">the</span> <span class="nx">units</span> <span class="nx">as</span>
                <span class="nx">milliseconds</span><span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">)</span> <span class="nx">or</span> <span class="nx">seconds</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">).</span> <span class="nx">The</span> <span class="k">default</span> <span class="nx">units</span> <span class="nx">are</span> <span class="s2">&quot;ms&quot;</span><span class="p">.</span>
  <span class="o">&lt;</span><span class="nx">count</span><span class="o">&gt;</span>       <span class="nb">Number</span> <span class="nx">of</span> <span class="nx">samples</span> <span class="nx">to</span> <span class="nx">take</span> <span class="nx">before</span> <span class="nx">terminating</span><span class="p">.</span>
  <span class="o">-</span><span class="nx">J</span><span class="o">&lt;</span><span class="nx">flag</span><span class="o">&gt;</span>      <span class="nx">Pass</span> <span class="o">&lt;</span><span class="nx">flag</span><span class="o">&gt;</span> <span class="nx">directly</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">runtime</span> <span class="nx">system</span><span class="p">.</span>
</pre></div>


<ul>
<li>options</li>
</ul>
<p>-class                 显示ClassLoad的相关信息；<br />
-compiler           显示JIT编译的相关信息；<br />
-gc                     显示和gc相关的堆信息；<br />
-gccapacity 　　  显示各个代的容量以及使用情况；<br />
-gcmetacapacity 显示metaspace的大小<br />
-gcnew               显示新生代信息；<br />
-gcnewcapacity  显示新生代大小和使用情况；<br />
-gcold                 显示老年代和永久代的信息；<br />
-gcoldcapacity    显示老年代的大小；<br />
-gcutil　　           显示垃圾收集信息；<br />
-gccause             显示垃圾回收的相关信息（通-gcutil）,同时显示最后一次或当前正在发生的垃圾回收的诱因；<br />
-printcompilation 输出JIT编译的方法信息；</p>
<ul>
<li>例1</li>
</ul>
<div class="hlcode"><pre><span class="nx">mubi</span><span class="err">@</span><span class="nx">mubideMacBook</span><span class="o">-</span><span class="nx">Pro</span> <span class="nx">webapps</span> <span class="nx">$</span> <span class="nx">jps</span>
<span class="mi">4402</span> <span class="nx">Jps</span>
<span class="mi">2611</span> <span class="nx">Launcher</span>
<span class="mi">1812</span>
<span class="mi">3800</span>
<span class="mi">82874</span>
<span class="mi">44363</span> <span class="nx">MacLauncher</span>
<span class="mi">28461</span> <span class="nx">ApacheJMeter</span><span class="p">.</span><span class="nx">jar</span>
<span class="nx">mubi</span><span class="err">@</span><span class="nx">mubideMacBook</span><span class="o">-</span><span class="nx">Pro</span> <span class="nx">webapps</span> <span class="nx">$</span> <span class="nx">jstat</span> <span class="o">-</span><span class="nx">gc</span> <span class="mi">28461</span>
 <span class="nx">S0C</span>    <span class="nx">S1C</span>    <span class="nx">S0U</span>    <span class="nx">S1U</span>      <span class="nx">EC</span>       <span class="nx">EU</span>        <span class="nx">OC</span>         <span class="nx">OU</span>       <span class="nx">MC</span>     <span class="nx">MU</span>    <span class="nx">CCSC</span>   <span class="nx">CCSU</span>   <span class="nx">YGC</span>     <span class="nx">YGCT</span>    <span class="nx">FGC</span>    <span class="nx">FGCT</span>     <span class="nx">GCT</span>
 <span class="mf">0.0</span>   <span class="mf">1024.0</span>  <span class="mf">0.0</span>   <span class="mf">1024.0</span> <span class="mf">659456.0</span> <span class="mf">158720.0</span>  <span class="mf">388096.0</span>   <span class="mf">29131.9</span>   <span class="mf">51324.0</span> <span class="mf">49395.6</span> <span class="mf">7344.0</span> <span class="mf">6748.7</span>     <span class="mi">27</span>    <span class="mf">0.919</span>   <span class="mi">5</span>      <span class="mf">0.921</span>    <span class="mf">1.840</span>
<span class="nx">mubi</span><span class="err">@</span><span class="nx">mubideMacBook</span><span class="o">-</span><span class="nx">Pro</span> <span class="nx">webapps</span> <span class="nx">$</span>
</pre></div>


<p>S0C：第一个幸存区的大小<br />
S1C：第二个幸存区的大小<br />
S0U：第一个幸存区的使用大小<br />
S1U：第二个幸存区的使用大小<br />
EC：伊甸园区的大小<br />
EU：伊甸园区的使用大小<br />
OC：老年代大小<br />
OU：老年代使用大小<br />
MC：方法区大小<br />
MU：方法区使用大小<br />
CCSC:压缩类空间大小<br />
CCSU:压缩类空间使用大小<br />
YGC：年轻代垃圾回收次数<br />
YGCT：年轻代垃圾回收消耗时间<br />
FGC：老年代垃圾回收次数<br />
FGCT：老年代垃圾回收消耗时间<br />
GCT：垃圾回收消耗总时间</p>
<ul>
<li>例2</li>
</ul>
<div class="hlcode"><pre> <span class="nx">jstat</span> <span class="o">-</span><span class="nx">gccapacity</span> <span class="mi">8207</span>
 <span class="nx">NGCMN</span>    <span class="nx">NGCMX</span>     <span class="nx">NGC</span>     <span class="nx">S0C</span>   <span class="nx">S1C</span>       <span class="nx">EC</span>      <span class="nx">OGCMN</span>      <span class="nx">OGCMX</span>       <span class="nx">OGC</span>         <span class="nx">OC</span>       <span class="nx">MCMN</span>     <span class="nx">MCMX</span>      <span class="nx">MC</span>     <span class="nx">CCSMN</span>    <span class="nx">CCSMX</span>     <span class="nx">CCSC</span>    <span class="nx">YGC</span>    <span class="nx">FGC</span>
     <span class="mf">0.0</span> <span class="mf">1048576.0</span>  <span class="mf">82944.0</span>    <span class="mf">0.0</span> <span class="mf">7168.0</span>  <span class="mf">75776.0</span>        <span class="mf">0.0</span>  <span class="mf">1048576.0</span>   <span class="mf">965632.0</span>   <span class="mf">965632.0</span>      <span class="mf">0.0</span> <span class="mf">1083392.0</span>  <span class="mf">40572.0</span>      <span class="mf">0.0</span> <span class="mf">1048576.0</span>   <span class="mf">6320.0</span>      <span class="mi">6</span>     <span class="mi">0</span>
</pre></div>


<p>NGCMN：年轻代(young)中初始化(最小)的大小(字节)<br />
NGCMX：年轻代(young)的最大容量 (字节)<br />
NGC：年轻代(young)中当前的容量 (字节)<br />
S0C：年轻代中第一个survivor（幸存区）的容量 (字节)<br />
S1C：年轻代中第二个survivor（幸存区）的容量 (字节)<br />
EC：年轻代中Eden（伊甸园）的容量 (字节)<br />
OGCMN：old代中初始化(最小)的大小 (字节)<br />
OGCMX：old代的最大容量(字节)<br />
OGC：old代当前新生成的容量 (字节)<br />
OC：Old代的容量 (字节)<br />
MCMN：metaspace(元空间)中初始化(最小)的大小 (字节)<br />
MCMX：metaspace(元空间)的最大容量 (字节)<br />
MC：metaspace(元空间)当前新生成的容量 (字节)<br />
CCSMN：最小压缩类空间大小<br />
CCSMX：最大压缩类空间大小<br />
CCSC：当前压缩类空间大小<br />
YGC：从应用程序启动到采样时年轻代中gc次数<br />
FGC：从应用程序启动到采样时old代(全gc)gc次数</p>
<ul>
<li>例3 每隔1秒打印一次gc信息，总共打印5次</li>
</ul>
<div class="hlcode"><pre><span class="nx">jstat</span> <span class="o">-</span><span class="nx">gcutil</span> <span class="mi">8207</span> <span class="mi">1000</span> <span class="mi">5</span>
  <span class="nx">S0</span>     <span class="nx">S1</span>     <span class="nx">E</span>      <span class="nx">O</span>      <span class="nx">M</span>     <span class="nx">CCS</span>    <span class="nx">YGC</span>     <span class="nx">YGCT</span>    <span class="nx">FGC</span>    <span class="nx">FGCT</span>     <span class="nx">GCT</span>
  <span class="mf">0.00</span> <span class="mf">100.00</span>  <span class="mf">43.24</span>   <span class="mf">3.73</span>  <span class="mf">97.04</span>  <span class="mf">92.86</span>      <span class="mi">6</span>    <span class="mf">0.058</span>     <span class="mi">0</span>    <span class="mf">0.000</span>    <span class="mf">0.058</span>
  <span class="mf">0.00</span> <span class="mf">100.00</span>  <span class="mf">43.24</span>   <span class="mf">3.73</span>  <span class="mf">97.04</span>  <span class="mf">92.86</span>      <span class="mi">6</span>    <span class="mf">0.058</span>     <span class="mi">0</span>    <span class="mf">0.000</span>    <span class="mf">0.058</span>
  <span class="mf">0.00</span> <span class="mf">100.00</span>  <span class="mf">43.24</span>   <span class="mf">3.73</span>  <span class="mf">97.04</span>  <span class="mf">92.86</span>      <span class="mi">6</span>    <span class="mf">0.058</span>     <span class="mi">0</span>    <span class="mf">0.000</span>    <span class="mf">0.058</span>
  <span class="mf">0.00</span> <span class="mf">100.00</span>  <span class="mf">43.24</span>   <span class="mf">3.73</span>  <span class="mf">97.04</span>  <span class="mf">92.86</span>      <span class="mi">6</span>    <span class="mf">0.058</span>     <span class="mi">0</span>    <span class="mf">0.000</span>    <span class="mf">0.058</span>
  <span class="mf">0.00</span> <span class="mf">100.00</span>  <span class="mf">43.24</span>   <span class="mf">3.73</span>  <span class="mf">97.04</span>  <span class="mf">92.86</span>      <span class="mi">6</span>    <span class="mf">0.058</span>     <span class="mi">0</span>    <span class="mf">0.000</span>    <span class="mf">0.058</span>
</pre></div>


<h2 id="jmap">jmap</h2>
<ul>
<li>dump jvm信息</li>
</ul>
<div class="hlcode"><pre><span class="n">jmap</span> <span class="o">-</span><span class="nl">dump:</span><span class="n">format</span><span class="o">=</span><span class="n">b</span><span class="o">,</span><span class="n">file</span><span class="o">=</span><span class="n">xx</span><span class="o">.</span><span class="na">hprof</span> <span class="o">&lt;</span><span class="n">pid</span><span class="o">&gt;</span>
</pre></div>


<h2 id="jstack">jstack</h2>
<ul>
<li>堆栈信息</li>
</ul>
<div class="hlcode"><pre><span class="n">jstack</span> <span class="o">-</span><span class="n">F</span> <span class="o">&lt;</span><span class="n">PID</span><span class="o">&gt;</span>
</pre></div>


<h2 id="jcmd">jcmd</h2>
<ul>
<li>查看当前机器上所有的<code>jvm</code>进程信息</li>
</ul>
<div class="hlcode"><pre><span class="n">jcmd</span> <span class="o">-</span><span class="n">l</span>
</pre></div>


<ul>
<li>列出某个jvm进程可以执行的操作</li>
</ul>
<div class="hlcode"><pre><span class="n">mubi</span><span class="nd">@mubideMacBook</span><span class="o">-</span><span class="n">Pro</span> <span class="n">Downloads</span> <span class="n">$</span> <span class="n">jcmd</span> <span class="mi">22553</span> <span class="n">help</span>
<span class="mi">22553</span><span class="o">:</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">commands</span> <span class="n">are</span> <span class="nl">available:</span>
<span class="n">JFR</span><span class="o">.</span><span class="na">stop</span>
<span class="n">JFR</span><span class="o">.</span><span class="na">start</span>
<span class="n">JFR</span><span class="o">.</span><span class="na">dump</span>
<span class="n">JFR</span><span class="o">.</span><span class="na">check</span>
<span class="n">VM</span><span class="o">.</span><span class="na">native_memory</span>
<span class="n">VM</span><span class="o">.</span><span class="na">check_commercial_features</span>
<span class="n">VM</span><span class="o">.</span><span class="na">unlock_commercial_features</span>
<span class="n">ManagementAgent</span><span class="o">.</span><span class="na">stop</span>
<span class="n">ManagementAgent</span><span class="o">.</span><span class="na">start_local</span>
<span class="n">ManagementAgent</span><span class="o">.</span><span class="na">start</span>
<span class="n">GC</span><span class="o">.</span><span class="na">rotate_log</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">print</span>
<span class="n">GC</span><span class="o">.</span><span class="na">class_stats</span>
<span class="n">GC</span><span class="o">.</span><span class="na">class_histogram</span>
<span class="n">GC</span><span class="o">.</span><span class="na">heap_dump</span>
<span class="n">GC</span><span class="o">.</span><span class="na">run_finalization</span>
<span class="n">GC</span><span class="o">.</span><span class="na">run</span>
<span class="n">VM</span><span class="o">.</span><span class="na">uptime</span>
<span class="n">VM</span><span class="o">.</span><span class="na">flags</span>
<span class="n">VM</span><span class="o">.</span><span class="na">system_properties</span>
<span class="n">VM</span><span class="o">.</span><span class="na">command_line</span>
<span class="n">VM</span><span class="o">.</span><span class="na">version</span>
<span class="n">help</span>

<span class="n">For</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">command</span> <span class="n">use</span> <span class="err">&#39;</span><span class="n">help</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span><span class="err">&#39;</span><span class="o">.</span>
<span class="n">mubi</span><span class="nd">@mubideMacBook</span><span class="o">-</span><span class="n">Pro</span> <span class="n">Downloads</span> <span class="n">$</span>
</pre></div>


<ul>
<li>查看进程内存区域的详情(jvm加上<code>-XX:NativeMemoryTracking=detail</code>)</li>
</ul>
<div class="hlcode"><pre><span class="n">mubi</span><span class="nd">@mubideMacBook</span><span class="o">-</span><span class="n">Pro</span> <span class="n">Downloads</span> <span class="n">$</span> <span class="n">jcmd</span> <span class="mi">22553</span> <span class="n">VM</span><span class="o">.</span><span class="na">native_memory</span> <span class="n">detail</span> <span class="o">&gt;</span> <span class="mi">22553</span><span class="o">.</span><span class="na">native_detail</span>
<span class="n">mubi</span><span class="nd">@mubideMacBook</span><span class="o">-</span><span class="n">Pro</span> <span class="n">Downloads</span> <span class="n">$</span> <span class="n">head</span> <span class="mi">22553</span><span class="o">.</span><span class="na">native_detail</span>
<span class="mi">22553</span><span class="o">:</span>

<span class="n">Native</span> <span class="n">Memory</span> <span class="nl">Tracking:</span>

<span class="nl">Total:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">6033952</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">2097428</span><span class="n">KB</span>
<span class="o">-</span>                 <span class="n">Java</span> <span class="n">Heap</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">4194304</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">1537024</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="nl">mmap:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">4194304</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">1537024</span><span class="n">KB</span><span class="o">)</span>

<span class="o">-</span>                     <span class="n">Class</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">1125078</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">85206</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">classes</span> <span class="err">#</span><span class="mi">14483</span><span class="o">)</span>
<span class="n">mubi</span><span class="nd">@mubideMacBook</span><span class="o">-</span><span class="n">Pro</span> <span class="n">Downloads</span> <span class="n">$</span>
</pre></div>


<h3 id="native-memory-trackingnmt">Native Memory Tracking(简称:NMT) 分析</h3>
<p>参考文档见：<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr007.html">NMT</a></p>
<div class="hlcode"><pre><span class="mi">22553</span><span class="o">:</span>

<span class="n">Native</span> <span class="n">Memory</span> <span class="nl">Tracking:</span>

<span class="nl">Total:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">6033952</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">2097428</span><span class="n">KB</span>
<span class="o">-</span>                 <span class="n">Java</span> <span class="n">Heap</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">4194304</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">1537024</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="nl">mmap:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">4194304</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">1537024</span><span class="n">KB</span><span class="o">)</span> 

<span class="o">-</span>                     <span class="n">Class</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">1125078</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">85206</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">classes</span> <span class="err">#</span><span class="mi">14483</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">6870</span><span class="n">KB</span> <span class="err">#</span><span class="mi">17632</span><span class="o">)</span> 
                            <span class="o">(</span><span class="nl">mmap:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">1118208</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">78336</span><span class="n">KB</span><span class="o">)</span> 

<span class="o">-</span>                    <span class="n">Thread</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">130665</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">130665</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">thread</span> <span class="err">#</span><span class="mi">128</span><span class="o">)</span>
                            <span class="o">(</span><span class="nl">stack:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">130048</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">130048</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">404</span><span class="n">KB</span> <span class="err">#</span><span class="mi">641</span><span class="o">)</span> 
                            <span class="o">(</span><span class="n">arena</span><span class="o">=</span><span class="mi">214</span><span class="n">KB</span> <span class="err">#</span><span class="mi">255</span><span class="o">)</span>

<span class="o">-</span>                      <span class="n">Code</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">254310</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">25318</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">4710</span><span class="n">KB</span> <span class="err">#</span><span class="mi">11332</span><span class="o">)</span> 
                            <span class="o">(</span><span class="nl">mmap:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">249600</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">20608</span><span class="n">KB</span><span class="o">)</span> 

<span class="o">-</span>                        <span class="n">GC</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">159021</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">148641</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">5777</span><span class="n">KB</span> <span class="err">#</span><span class="mi">297</span><span class="o">)</span> 
                            <span class="o">(</span><span class="nl">mmap:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">153244</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">142864</span><span class="n">KB</span><span class="o">)</span> 

<span class="o">-</span>                  <span class="n">Compiler</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">177</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">177</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">46</span><span class="n">KB</span> <span class="err">#</span><span class="mi">844</span><span class="o">)</span> 
                            <span class="o">(</span><span class="n">arena</span><span class="o">=</span><span class="mi">131</span><span class="n">KB</span> <span class="err">#</span><span class="mi">3</span><span class="o">)</span>

<span class="o">-</span>                  <span class="n">Internal</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">143983</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">143983</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">143951</span><span class="n">KB</span> <span class="err">#</span><span class="mi">18708</span><span class="o">)</span> 
                            <span class="o">(</span><span class="nl">mmap:</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">32</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">32</span><span class="n">KB</span><span class="o">)</span> 

<span class="o">-</span>                    <span class="n">Symbol</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">21199</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">21199</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">17164</span><span class="n">KB</span> <span class="err">#</span><span class="mi">176970</span><span class="o">)</span> 
                            <span class="o">(</span><span class="n">arena</span><span class="o">=</span><span class="mi">4036</span><span class="n">KB</span> <span class="err">#</span><span class="mi">1</span><span class="o">)</span>

<span class="o">-</span>    <span class="n">Native</span> <span class="n">Memory</span> <span class="n">Tracking</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">3693</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">3693</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">120</span><span class="n">KB</span> <span class="err">#</span><span class="mi">1832</span><span class="o">)</span> 
                            <span class="o">(</span><span class="n">tracking</span> <span class="n">overhead</span><span class="o">=</span><span class="mi">3573</span><span class="n">KB</span><span class="o">)</span>

<span class="o">-</span>               <span class="n">Arena</span> <span class="n">Chunk</span> <span class="o">(</span><span class="n">reserved</span><span class="o">=</span><span class="mi">1521</span><span class="n">KB</span><span class="o">,</span> <span class="n">committed</span><span class="o">=</span><span class="mi">1521</span><span class="n">KB</span><span class="o">)</span>
                            <span class="o">(</span><span class="n">malloc</span><span class="o">=</span><span class="mi">1521</span><span class="n">KB</span><span class="o">)</span> 

<span class="n">Virtual</span> <span class="n">memory</span> <span class="nl">map:</span>

<span class="o">[</span><span class="mh">0x00000001025e7000</span> <span class="o">-</span> <span class="mh">0x00000001025ef000</span><span class="o">]</span> <span class="n">reserved</span> <span class="n">and</span> <span class="n">committed</span> <span class="mi">32</span><span class="n">KB</span> <span class="k">for</span> <span class="n">Internal</span> <span class="n">from</span>
    <span class="o">[</span><span class="mh">0x00000001032b4ae8</span><span class="o">]</span> <span class="nl">PerfMemory:</span><span class="o">:</span><span class="n">create_memory_region</span><span class="o">(</span><span class="n">unsigned</span> <span class="kt">long</span><span class="o">)+</span><span class="mh">0x728</span>
    <span class="o">[</span><span class="mh">0x00000001032b41ef</span><span class="o">]</span> <span class="nl">PerfMemory:</span><span class="o">:</span><span class="n">initialize</span><span class="o">()+</span><span class="mh">0x39</span>
    <span class="o">[</span><span class="mh">0x0000000103370c79</span><span class="o">]</span> <span class="nl">Threads:</span><span class="o">:</span><span class="n">create_vm</span><span class="o">(</span><span class="n">JavaVMInitArgs</span><span class="o">*,</span> <span class="n">bool</span><span class="o">*)+</span><span class="mh">0x13b</span>
    <span class="o">[</span><span class="mh">0x000000010312586e</span><span class="o">]</span> <span class="n">JNI_CreateJavaVM</span><span class="o">+</span><span class="mh">0x76</span>
</pre></div>


<ul>
<li>committed 为真正使用的内存</li>
</ul>
<div class="hlcode"><pre> <span class="n">From</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">output</span> <span class="n">below</span><span class="o">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">see</span> <span class="n">reserved</span> <span class="n">and</span> <span class="n">committed</span> <span class="n">memory</span><span class="o">.</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">only</span> <span class="n">committed</span> <span class="n">memory</span> <span class="n">is</span> <span class="n">actually</span> <span class="n">used</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="o">,</span> <span class="k">if</span> <span class="n">you</span> <span class="n">run</span> <span class="n">with</span> <span class="o">-</span><span class="n">Xms100m</span> <span class="o">-</span><span class="n">Xmx1000m</span><span class="o">,</span> <span class="n">the</span> <span class="n">JVM</span> <span class="n">will</span> <span class="n">reserve</span> <span class="mi">1000</span> <span class="n">MB</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Java</span> <span class="n">Heap</span><span class="o">.</span> <span class="n">Since</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">heap</span> <span class="n">size</span> <span class="n">is</span> <span class="n">only</span> <span class="mi">100</span> <span class="n">MB</span><span class="o">,</span> <span class="n">only</span> <span class="mi">100</span><span class="n">MB</span> <span class="n">will</span> <span class="n">be</span> <span class="n">committed</span> <span class="n">to</span> <span class="n">begin</span> <span class="n">with</span><span class="o">.</span> <span class="n">For</span> <span class="n">a</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span> <span class="n">machine</span> <span class="n">where</span> <span class="n">address</span> <span class="n">space</span> <span class="n">is</span> <span class="n">almost</span> <span class="n">unlimited</span><span class="o">,</span> <span class="n">there</span> <span class="n">is</span> <span class="n">no</span> <span class="n">problem</span> <span class="k">if</span> <span class="n">a</span> <span class="n">JVM</span> <span class="n">reserves</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">memory</span><span class="o">.</span> <span class="n">The</span> <span class="n">problem</span> <span class="n">arises</span> <span class="k">if</span> <span class="n">more</span> <span class="n">and</span> <span class="n">more</span> <span class="n">memory</span> <span class="n">gets</span> <span class="n">committed</span><span class="o">,</span> <span class="n">which</span> <span class="n">may</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">swapping</span> <span class="n">or</span> <span class="kd">native</span> <span class="n">OOM</span> <span class="n">situations</span><span class="o">.</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 doctording.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-02-09 22:56:28</p>
      </span>
    </div>

    
    
  </body>
</html>