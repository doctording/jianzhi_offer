---
title: "Zookeeper"
layout: page
date: 2020-07-12 00:00
---

[TOC]

# Zookeeper

<a href='https://blog.csdn.net/qq_26437925/category_9176864.html'>zk blog笔记</a>

## 谈谈对zookeeper的认识？

文件系统 + 通知机制

* 可以看成是一个数据库（可以增删改查数据,能存储数据）
* 可以看成是一个文件系统（有类似文件系统的目录树结构）
* 是一个分布式的数据库，可以解决数据一致性问题(zk集群的主从同步，数据一致性的保证)
* 具有发布/订阅功能的分布式数据库(节点watch机制)

## Zookeeper 都有哪些功能？

* 集群管理：监控节点存活状态、运行请求等；

* 主节点选举：主节点挂掉了之后可以从备用的节点开始新一轮选主，主节点选举说的就是这个选举的过程，使用 Zookeeper 可以协助完成这个过程；

* 分布式锁：Zookeeper 提供两种锁：独占锁、共享锁。独占锁即一次只能有一个线程使用资源，共享锁是读锁共享，读写互斥，即可以有多线线程同时读同一个资源，如果要使用写锁也只能有一个线程使用。Zookeeper 可以对分布式锁进行控制

* 命名服务：在分布式系统中，通过使用命名服务，客户端应用能够根据指定名字来获取资源或服务的地址，提供者等信息

## 谈下你对 ZAB 协议的了解？

Zab协议(ZooKeeper Atomic Broadcast protocol)

ZAB 协议是为分布式协调服务 Zookeeper 专门设计的一种支持崩溃恢复的原子广播协议。ZAB 协议包括两种基本的模式：**崩溃恢复**和**消息广播**

当整个 Zookeeper 集群刚刚启动或者Leader服务器宕机、重启或者网络故障导致不存在过半的服务器与 Leader 服务器保持正常通信时，所有服务器进入**崩溃恢复模式**，首先选举产生新的 Leader 服务器，然后集群中 Follower 服务器开始与新的 Leader 服务器进行数据同步；当集群中超过半数机器与该 Leader 服务器完成数据同步之后，退出恢复模式进入**消息广播模式**，Leader 服务器开始接收客户端的事务请求生成事物提案来进行事务请求处理

## 强一致性、弱一致性、最终一致性？

一致性（Consistency）是指多副本（Replications）问题中的数据一致性。可以分为强一致性、顺序一致性与弱一致性。

* 强一致性（Strict Consistency）

要求：
    * 任何一次读都能读到某个数据的最近一次写的数据
    * 系统中的所有进程，看到的操作顺序，都和全局时钟下的顺序一致

* 最终一致性

不保证在任意时刻任意节点上的同一份数据都是相同的，但是随着时间的迁移，不同节点上的同一份数据总是在向趋同的方向变化。
简单说，就是在一段时间后，节点间的数据会最终达到一致状态。

* 弱一致性

数据更新后，如果能容忍后续的访问只能访问到部分或者全部访问不到，则是弱一致性

最终一致性就属于弱一致性

## zk节点的几种类型？

* PERSISTENT-持久节点

除非手动删除，否则节点一直存在于 Zookeeper 上

* EPHEMERAL-临时节点

临时节点的生命周期与客户端会话绑定，一旦客户端会话失效（客户端与zookeeper 连接断开不一定会话失效），那么这个客户端创建的所有临时节点都会被移除。

* PERSISTENT_SEQUENTIAL-持久顺序节点

基本特性同持久节点，只是增加了顺序属性，节点名后边会追加一个由父节点维护的自增整型数字。

* EPHEMERAL_SEQUENTIAL-临时顺序节点

基本特性同临时节点，增加了顺序属性，节点名后边会追加一个由父节点维护的自增整型数字。

## 通知(Watch)机制原理？

// TODO
