<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/tango.css">
    <link rel="shortcut icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>《Java编程思想》第5章：初始化和清理 - 剑指Offer</title>
    <meta name="keywords" content="algorithm，python"/>
    <meta name="description" content="for python and algorithm"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/sword_at_offer/">Home</a>&nbsp;&#187;&nbsp;<a href="/sword_at_offer/#java_thinking_in_Java">java_thinking_in_Java</a>&nbsp;&#187;&nbsp;《Java编程思想》第5章：初始化和清理
    <span class="updated">Page Updated&nbsp;
      2018-12-12 00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">《Java编程思想》第5章：初始化和清理</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">初始化和清理</a><ul>
<li><a href="#_2">构造函数</a></li>
<li><a href="#_3">方法重载</a></li>
<li><a href="#static-this">static 与 this</a></li>
</ul>
</li>
<li><a href="#_4">清理： 终结处理和垃圾回收</a><ul>
<li><a href="#finalize">finalize()</a></li>
<li><a href="#_5">成员初始化</a><ul>
<li><a href="#_6">静态数据与初始化</a></li>
<li><a href="#_7">初始化顺序</a></li>
<li><a href="#_8">实例代码说明类初始化顺序</a></li>
<li><a href="#class-class">总结一个对象的创建过程(class &amp; class实例 =&gt; 对象)</a></li>
<li><a href="#_9">数组的初始化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="_1">初始化和清理</h1>
<h2 id="_2">构造函数</h2>
<p>调用构造函数是编译器的责任，必须要让编译器知道调用的是哪个方法；分配内存空间后，就会调用构造函数，确保使用对象前，对象已经被初始化了。</p>
<ul>
<li>函数名是类名</li>
<li>无参数的构造函数称为默认构造器</li>
<li>没有返回类型(不是返回类型为void，而是没有返回类型）（new返回了新建对象的引用）</li>
<li>this(所操作对象的引用) 能在类的内部方法使用（static不能使用），表示"调用方法的那个对象"的引用，编译器默认隐式的将this作为普通方法的第一个参数</li>
<li>尽管可以用this调用一个构造器，但是不能调用两个且必须置于起始的语句，否则会报错,类似<code>Error:(25, 13) java: 对this的调用必须是构造器中的第一个语句</code></li>
</ul>
<h2 id="_3">方法重载</h2>
<p>名字相同，但不需要有不同的参数类型列表</p>
<ul>
<li>不以返回值作区分</li>
<li>基本类型作为参数，编译器会选择部分类型提升和窄化</li>
</ul>
<h2 id="static-this">static 与 this</h2>
<ul>
<li>static方法是没有this的方法</li>
<li>static方法不能调用普通的方法，但普通的方法能调用static方法</li>
</ul>
<h1 id="_4">清理： 终结处理和垃圾回收</h1>
<ol>
<li>对象可能不被垃圾回收</li>
<li>垃圾回收并不等于<code>析构</code></li>
<li>垃圾回收只与内存有关：垃圾回收只对程序不再使用对内存进行回收</li>
</ol>
<p>JVM未面临内存耗尽对情形，它是不会浪费时间去执行垃圾回收以恢复内存的</p>
<h2 id="finalize">finalize()</h2>
<h2 id="_5">成员初始化</h2>
<p>Java尽力保证： 所有变量在使用前都能得到恰当的初始化。对于方法的局部变量，Java以编译时错误的形式来贯彻这种保证</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">f</span><span class="o">(){</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">;</span>
    <span class="n">i</span><span class="o">++;</span> <span class="c1">// Error, i not initiallized</span>
<span class="o">}</span>
</pre></div>


<p>对于类数据成员(即字段)是基本类型，即便没有初始化，会被默认为<code>0</code>值, 如果定义一个对象引用，却没有赋予初始值，则会出现<code>null</code>的情况</p>
<h3 id="_6">静态数据与初始化</h3>
<p>无论有多少个实例对象，静态数据都只占用一份存储，static关键字不能应用于局部变量，只能作用于域，其数据没有被初始化则会称为<code>0</code>或者<code>null</code></p>
<h3 id="_7">初始化顺序</h3>
<p>单个类的初始化顺序： 静态数据成员 -&gt; 静态代码块 -&gt; 非静态数据成员 -&gt; 非静态代码块 -&gt; 构造方法</p>
<p>代码执行从上到下，不合理的顺序会导致某些错误</p>
<h3 id="_8">实例代码说明类初始化顺序</h3>
<div class="hlcode"><pre><span class="kd">class</span> <span class="nc">Bowl</span><span class="o">{</span>
    <span class="n">Bowl</span><span class="o">(</span><span class="kt">int</span> <span class="n">marker</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Bowl(marker:%d)&quot;</span><span class="o">,</span> <span class="n">marker</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">f1</span><span class="o">(</span><span class="kt">int</span> <span class="n">marker</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;f1(marker:%d)&quot;</span><span class="o">,</span> <span class="n">marker</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Table</span><span class="o">{</span>
    <span class="kd">static</span> <span class="n">Bowl</span> <span class="n">bowl1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bowl</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">Table</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Table()&quot;</span><span class="o">);</span>
        <span class="n">bowl2</span><span class="o">.</span><span class="na">f1</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">f2</span><span class="o">(</span><span class="kt">int</span> <span class="n">marker</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;f2(marker:%d)&quot;</span><span class="o">,</span> <span class="n">marker</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="n">Bowl</span> <span class="n">bowl2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bowl</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Cupboard</span><span class="o">{</span>
    <span class="n">Bowl</span> <span class="n">boel3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bowl</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="kd">static</span> <span class="n">Bowl</span> <span class="n">bowl4</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bowl</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">Cupboard</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Cupboard()&quot;</span><span class="o">);</span>
        <span class="n">bowl4</span><span class="o">.</span><span class="na">f1</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">f3</span><span class="o">(</span><span class="kt">int</span> <span class="n">marker</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;f3(marker:%d)&quot;</span><span class="o">,</span> <span class="n">marker</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="n">Bowl</span> <span class="n">bowl5</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bowl</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Table</span><span class="o">();</span>
    <span class="kd">static</span> <span class="n">Cupboard</span> <span class="n">cupboard</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cupboard</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creating new Cupboard() in main()&quot;</span><span class="o">);</span>
        <span class="k">new</span> <span class="nf">Cupboard</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creating new Cupboard() in main()&quot;</span><span class="o">);</span>
        <span class="k">new</span> <span class="nf">Cupboard</span><span class="o">();</span>
        <span class="n">table</span><span class="o">.</span><span class="na">f2</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">cupboard</span><span class="o">.</span><span class="na">f3</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>


<div class="hlcode"><pre><span class="c1">// output</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">1</span><span class="o">)</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">2</span><span class="o">)</span>
<span class="n">Table</span><span class="o">()</span><span class="n">f1</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">1</span><span class="o">)</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">4</span><span class="o">)</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">5</span><span class="o">)</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">3</span><span class="o">)</span>
<span class="n">Cupboard</span><span class="o">()</span>
<span class="n">f1</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">2</span><span class="o">)</span>
<span class="n">Creating</span> <span class="k">new</span> <span class="nf">Cupboard</span><span class="o">()</span> <span class="n">in</span> <span class="n">main</span><span class="o">()</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">3</span><span class="o">)</span>
<span class="n">Cupboard</span><span class="o">()</span>
<span class="n">f1</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">2</span><span class="o">)</span>
<span class="n">Creating</span> <span class="k">new</span> <span class="nf">Cupboard</span><span class="o">()</span> <span class="n">in</span> <span class="n">main</span><span class="o">()</span>
<span class="n">Bowl</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">3</span><span class="o">)</span>
<span class="n">Cupboard</span><span class="o">()</span>
<span class="n">f1</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">2</span><span class="o">)</span>
<span class="n">f2</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">1</span><span class="o">)</span>
<span class="n">f3</span><span class="o">(</span><span class="nl">marker:</span><span class="mi">1</span><span class="o">)</span>
</pre></div>


<h3 id="class-class">总结一个对象的创建过程(class &amp; class实例 =&gt; 对象)</h3>
<p>假设有一个名为Dog的类</p>
<ol>
<li>即使没有显示地使用static关键字，构造器其实也可以看成静态方法。首次创建Dog类的对象时，或者Dog类的静态方法/静态域首次被访问时，Java解释器必须查找类路径，以定位Dog.class文件</li>
<li>
<p>然后载入Dog.class(这将创建一个Dog对象)，有关静态初始化的所有动作都会执行。因此，静态初始化只在Class对象首次加载的时候执行一次</p>
</li>
<li>
<p>当用new Dog()创建对象的时候，首先将在<code>堆</code>上为Dog对象分配足够的存储空间</p>
</li>
<li>这块存储空间会被清零，这就自动地将Dog对象中的所有基本类型都设置成了默认值（0，flase，null等默认值）</li>
<li>执行所有出现于字段定义外的初始化动作</li>
<li>执行构造器</li>
</ol>
<h3 id="_9">数组的初始化</h3>
<div class="hlcode"><pre><span class="kt">int</span><span class="o">[]</span> <span class="n">a1</span><span class="o">;</span> <span class="c1">// int a1[];</span>
</pre></div>


<p>编译器不允许制定数组的大小，只是个引用，并为该引用分配了足够的存储空间；为了给数组创建相应的存储空间，必须写初始化表达式。</p>
<p>数组的初始化动作可以出现在代码的任何地方，但也可以使用特殊的初始化表达式，但必须是在创建数组的地方出现，这种特殊的表达式是用<code>{}</code>扩起来的值组成的。</p>
<div class="hlcode"><pre><span class="c1">// 正确写法</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">a1</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}</span>
<span class="c1">// 错误写法</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">a1</span><span class="o">;</span>
<span class="n">a1</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}</span>
</pre></div>


<p>如果忘记了创建对象，并且试图使用数组中的空引用，就会出现runtime exception</p>
<p>由于所有的类都继承自<code>Object</code>类，所以也可以用Object数组</p>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 doctording.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-03-25 23:49:31</p>
      </span>
    </div>

    
    
  </body>
</html>