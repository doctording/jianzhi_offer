<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/tango.css">
    <link rel="shortcut icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>int(基本类型) & Integer(包装类类型) - 剑指Offer</title>
    <meta name="keywords" content="algorithm，python"/>
    <meta name="description" content="for python and algorithm"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/sword_at_offer/">Home</a>&nbsp;&#187;&nbsp;<a href="/sword_at_offer/#java_utils">java_utils</a>&nbsp;&#187;&nbsp;int(基本类型) & Integer(包装类类型)
    <span class="updated">Page Updated&nbsp;
      2019-03-24 00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">int(基本类型) & Integer(包装类类型)</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#int-integer">int &amp; Integer</a><ul>
<li><a href="#java-8">源码分析（Java 8）</a></li>
<li><a href="#valueofint-i">valueOf(int i) 源码</a></li>
<li><a href="#equalsobject-obj">equals(Object obj)源码</a></li>
<li><a href="#_1">自动装箱,拆箱</a></li>
<li><a href="#_2">基本类型与包装类型的异同：</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="int-integer">int &amp; Integer</h1>
<ul>
<li>Java8程序验证</li>
</ul>
<div class="hlcode"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mb</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">128</span><span class="o">;</span>
        <span class="n">Integer</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">128</span><span class="o">;</span>
        <span class="n">Integer</span> <span class="n">i3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="mi">128</span><span class="o">);</span>
        <span class="c1">//Integer会自动拆箱为int，所以为true</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">i2</span><span class="o">);</span>    <span class="c1">// true</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">i3</span><span class="o">);</span>    <span class="c1">// true</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;**************&quot;</span><span class="o">);</span>
        <span class="n">Integer</span> <span class="n">i5</span> <span class="o">=</span> <span class="mi">127</span><span class="o">;</span><span class="c1">//java在编译的时候,被翻译成-&gt; Integer i5 = Integer.valueOf(127);</span>
        <span class="n">Integer</span> <span class="n">i6</span> <span class="o">=</span> <span class="mi">127</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i5</span> <span class="o">==</span> <span class="n">i6</span><span class="o">);</span>   <span class="c1">//true, 127走了缓存，i5 i6是同一个对象</span>
        <span class="n">Integer</span> <span class="n">i5_1</span> <span class="o">=</span> <span class="mi">128</span><span class="o">;</span>
        <span class="n">Integer</span> <span class="n">i6_1</span> <span class="o">=</span> <span class="mi">128</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i5_1</span> <span class="o">==</span> <span class="n">i6_1</span><span class="o">);</span><span class="c1">//false, 128不走缓存，i5_1 i6_1不是同一个对象</span>
        <span class="n">Integer</span> <span class="n">ii5</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="mi">127</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i5</span> <span class="o">==</span> <span class="n">ii5</span><span class="o">);</span>  <span class="c1">// false， ii5是new出来的新对象</span>
        <span class="n">Integer</span> <span class="n">i7</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="mi">128</span><span class="o">);</span>
        <span class="n">Integer</span> <span class="n">i8</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i7</span> <span class="o">==</span> <span class="n">i8</span><span class="o">);</span>   <span class="c1">// false</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*output</span>

<span class="cm">true</span>
<span class="cm">true</span>
<span class="cm">**************</span>
<span class="cm">true</span>
<span class="cm">false</span>
<span class="cm">false</span>
<span class="cm">false</span>

<span class="cm"> */</span>
</pre></div>


<ul>
<li>建议是：包装类型间的判断使用<code>equals</code>, 而不是<code>==</code></li>
</ul>
<h2 id="java-8">源码分析（Java 8）</h2>
<h2 id="valueofint-i"><code>valueOf(int i)</code> 源码</h2>
<div class="hlcode"><pre><span class="cm">/**</span>
<span class="cm">    * Cache to support the object identity semantics of autoboxing for values between</span>
<span class="cm">    * -128 and 127 (inclusive) as required by JLS.</span>
<span class="cm">    *</span>
<span class="cm">    * The cache is initialized on first usage.  The size of the cache</span>
<span class="cm">    * may be controlled by the {@code -XX:AutoBoxCacheMax=&lt;size&gt;} option.</span>
<span class="cm">    * During VM initialization, java.lang.Integer.IntegerCache.high property</span>
<span class="cm">    * may be set and saved in the private system properties in the</span>
<span class="cm">    * sun.misc.VM class.</span>
<span class="cm">    */</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">IntegerCache</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="o">-</span><span class="mi">128</span><span class="o">;</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">high</span><span class="o">;</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">Integer</span> <span class="n">cache</span><span class="o">[];</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="c1">// high value may be configured by property</span>
        <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">127</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">integerCacheHighPropValue</span> <span class="o">=</span>
            <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">VM</span><span class="o">.</span><span class="na">getSavedProperty</span><span class="o">(</span><span class="s">&quot;java.lang.Integer.IntegerCache.high&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">integerCacheHighPropValue</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">parseInt</span><span class="o">(</span><span class="n">integerCacheHighPropValue</span><span class="o">);</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="mi">127</span><span class="o">);</span>
                <span class="c1">// Maximum array size is Integer.MAX_VALUE</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span> <span class="o">-</span> <span class="o">(-</span><span class="n">low</span><span class="o">)</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span><span class="o">(</span> <span class="n">NumberFormatException</span> <span class="n">nfe</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// If the property cannot be parsed into an int, ignore it.</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>

        <span class="n">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">[(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">low</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">cache</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">k</span><span class="o">++)</span>
            <span class="n">cache</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">j</span><span class="o">++);</span>

        <span class="c1">// range [-128, 127] must be interned (JLS7 5.1.7)</span>
        <span class="k">assert</span> <span class="n">IntegerCache</span><span class="o">.</span><span class="na">high</span> <span class="o">&gt;=</span> <span class="mi">127</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nf">IntegerCache</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="c1">// valueOf 会使用 IntegerCache</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Integer</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">IntegerCache</span><span class="o">.</span><span class="na">low</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">IntegerCache</span><span class="o">.</span><span class="na">high</span><span class="o">)</span>
        <span class="k">return</span> <span class="n">IntegerCache</span><span class="o">.</span><span class="na">cache</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="o">(-</span><span class="n">IntegerCache</span><span class="o">.</span><span class="na">low</span><span class="o">)];</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<p>对于<code>-128</code>到<code>127</code>之间的数，会进行缓存，<code>Integer i = 127</code>时，会将<code>127</code>进行缓存，下次再写<code>Integer j = 127</code>时，就会直接从缓存中取，就不会<code>new</code>了</p>
<h2 id="equalsobject-obj"><code>equals(Object obj)</code>源码</h2>
<div class="hlcode"><pre><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Integer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="o">((</span><span class="n">Integer</span><span class="o">)</span><span class="n">obj</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>


<h2 id="_1">自动装箱,拆箱</h2>
<ul>
<li>
<p><code>int</code>的自动装箱都是通过<code>Integer.valueOf()</code>方法来实现的</p>
</li>
<li>
<p><code>Integer</code>的自动拆箱都是通过<code>Integer.intValue</code>来实现的</p>
</li>
</ul>
<h2 id="_2">基本类型与包装类型的异同：</h2>
<ul>
<li>
<p>存储方式及位置的不同，基本类型是直接存储变量的值，保存在堆栈中能高效的存取；封装类型需要通过引用指向实例，具体的实例保存在堆中；</p>
</li>
<li>
<p>初始值的不同，封装类型的初始值为null，基本类型的的初始值视具体的类型而定，比如int类型的初始值为0，boolean类型为false；</p>
</li>
<li>
<p>使用方式的不同，比如与集合类合作使用时只能使用包装类型。</p>
</li>
<li>
<p>什么时候该用包装类，什么时候该用基本类型，看基本的业务来定：这个字段允不允许null值，如果允许，则必然要用封装类；否则，基本类型就可以了。如果用到比如泛型和反射调用函数，就需要用包装类！</p>
</li>
</ul>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 doctording.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-06-01 20:41:07</p>
      </span>
    </div>

    
    
  </body>
</html>