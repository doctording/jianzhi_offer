<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/tango.css">
    <link rel="shortcut icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>观察者模式 - 剑指Offer</title>
    <meta name="keywords" content="algorithm，python"/>
    <meta name="description" content="for python and algorithm"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/sword_at_offer/">Home</a>&nbsp;&#187;&nbsp;<a href="/sword_at_offer/#design_pattern">design_pattern</a>&nbsp;&#187;&nbsp;观察者模式
    <span class="updated">Page Updated&nbsp;
      2019-03-20 00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">观察者模式</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">观察者模式</a></li>
</ul>
</div>
<h1 id="_1">观察者模式</h1>
<p>观察者模式使用三个类: Subject(被观察的主体)、Observer(观察者) 和 Client</p>
<p>Subject的操作会通知所有注册的Observer,Subject可以添加删除Observer</p>
<ul>
<li>Subject</li>
</ul>
<div class="hlcode"><pre><span class="kn">package</span> <span class="n">design</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Vector</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2020/6/17 09:27</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Subject</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;</span> <span class="n">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">state</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="kt">int</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
        <span class="n">notifyAllObservers</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span><span class="o">){</span>
        <span class="n">observers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span><span class="o">){</span>
        <span class="n">observers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyAllObservers</span><span class="o">(){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span> <span class="o">:</span> <span class="n">observers</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">observer</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<ul>
<li>Observer 抽象类</li>
</ul>
<div class="hlcode"><pre><span class="kn">package</span> <span class="n">design</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2020/6/17 09:27</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">Subject</span> <span class="n">subject</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<ul>
<li>具体的Observer类</li>
</ul>
<div class="hlcode"><pre><span class="kn">package</span> <span class="n">design</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2020/6/17 09:27</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BinaryObserver</span> <span class="kd">extends</span> <span class="n">Observer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">BinaryObserver</span><span class="o">(</span><span class="n">Subject</span> <span class="n">subject</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Binary String: &quot;</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toBinaryString</span><span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">getState</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="hlcode"><pre><span class="kn">package</span> <span class="n">design</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2020/6/17 09:28</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OctalObserver</span> <span class="kd">extends</span> <span class="n">Observer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">OctalObserver</span><span class="o">(</span><span class="n">Subject</span> <span class="n">subject</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Octal String: &quot;</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toOctalString</span><span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">getState</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<ul>
<li>测试</li>
</ul>
<div class="hlcode"><pre><span class="kn">package</span> <span class="n">design</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2020/6/17 09:32</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DesignTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Subject</span><span class="o">();</span>

        <span class="n">Observer</span> <span class="n">observer1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryObserver</span><span class="o">(</span><span class="n">subject</span><span class="o">);</span>
        <span class="n">Observer</span> <span class="n">observer2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OctalObserver</span><span class="o">(</span><span class="n">subject</span><span class="o">);</span>

        <span class="n">subject</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">observer1</span><span class="o">);</span>
        <span class="n">subject</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">observer2</span><span class="o">);</span>

        <span class="n">subject</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>

        <span class="n">subject</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>

        <span class="n">subject</span><span class="o">.</span><span class="na">delObserver</span><span class="o">(</span><span class="n">observer1</span><span class="o">);</span>

        <span class="n">subject</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="mi">13</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>输出：</p>
<div class="hlcode"><pre><span class="n">Binary</span> <span class="nl">String:</span> <span class="mi">1010</span>
<span class="n">Octal</span> <span class="nl">String:</span> <span class="mi">12</span>

<span class="n">Binary</span> <span class="nl">String:</span> <span class="mi">1100</span>
<span class="n">Octal</span> <span class="nl">String:</span> <span class="mi">14</span>

<span class="n">Octal</span> <span class="nl">String:</span> <span class="mi">15</span> <span class="c1">// 此前删除了 BinaryObserver</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 doctording.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-07-16 23:33:44</p>
      </span>
    </div>

    
    
  </body>
</html>