<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/sword_at_offer/static/css/tango.css">
    <link rel="shortcut icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/sword_at_offer/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>《Java编程思想》第7章：复用类 - 剑指Offer</title>
    <meta name="keywords" content="algorithm，python"/>
    <meta name="description" content="for python and algorithm"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/sword_at_offer/">Home</a>&nbsp;&#187;&nbsp;<a href="/sword_at_offer/#java_thinking_in_Java">java_thinking_in_Java</a>&nbsp;&#187;&nbsp;《Java编程思想》第7章：复用类
    <span class="updated">Page Updated&nbsp;
      2018-12-12 00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">《Java编程思想》第7章：复用类</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#protected">protected 继承 与 权限</a></li>
<li><a href="#_1">向上转型</a></li>
<li><a href="#final-">final（无法改变的）- 设计或效率</a><ul>
<li><a href="#final">final 参数</a></li>
<li><a href="#final_1">final 方法</a></li>
<li><a href="#final_2">final 类</a></li>
</ul>
</li>
<li><a href="#_2">初始化及类的加载</a></li>
</ul>
</div>
<p>Java中问题的解决是围绕<code>类</code>展开的</p>
<ul>
<li>组合 <code>has-a</code></li>
<li>继承(extends，super) <code>is-a</code></li>
<li>代理</li>
</ul>
<h2 id="protected">protected 继承 与 权限</h2>
<p>包，类，子类</p>
<div class="hlcode"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2019/2/11 6:53 PM</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bowl</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Bowl</span><span class="o">(</span><span class="kt">int</span> <span class="n">_a</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_a</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="kt">int</span> <span class="n">_a</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">_a</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Bowl{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;a=&quot;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="hlcode"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2019/2/11 6:54 PM</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BowlSon</span> <span class="kd">extends</span> <span class="n">Bowl</span><span class="o">{</span>
    <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">BowlSon</span><span class="o">(</span><span class="kt">int</span> <span class="n">_a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_b</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">_a</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">_b</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">change</span><span class="o">(</span><span class="kt">int</span> <span class="n">_a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_b</span><span class="o">){</span>
        <span class="c1">// 子类方法能够访问基类的set方法，因为set方法在子类中是protected</span>
        <span class="n">set</span><span class="o">(</span><span class="n">_a</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">_b</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;BowlFa{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;b=&quot;</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span> <span class="o">+</span> <span class="kd">super</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="hlcode"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">other</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.test.Bowl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.BowlSon</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @Author mubi</span>
<span class="cm"> * @Date 2019/2/11 6:57 PM</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainOther</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Bowl</span> <span class="n">b1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bowl</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">BowlSon</span> <span class="n">bowlSon</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BowlSon</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">bowlSon</span><span class="o">.</span><span class="na">change</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">b1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bowlSon</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="_1">向上转型</h2>
<p>如下：<code>Wind</code>继承<code>Instrument</code>,将<code>Wind</code>转换成<code>Instrument</code>引用的动作，称为<strong>向上转型</strong>； 同理：向下转型</p>
<div class="hlcode"><pre>Instrument
    ^
    |
  Wind
</pre></div>


<p>继承和组合的选择： 如果需要从新类到基类的向上转型，那么继承是必要的，否则需要考虑用继承还是用组合</p>
<h2 id="final-">final（无法改变的）- 设计或效率</h2>
<p>final 数据认识</p>
<div class="hlcode"><pre><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Value</span><span class="o">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Value</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FinalData</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">FinalData</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// can be compile-time constants</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">valueOne</span> <span class="o">=</span> <span class="mi">9</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">VALUE_TWO</span> <span class="o">=</span> <span class="mi">99</span><span class="o">;</span>
    <span class="c1">// Typical public constant</span>
    <span class="c1">// final 说明是个常量， static 强调只有一份 （编译期常量）</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">VALUE_THREE</span> <span class="o">=</span> <span class="mi">39</span><span class="o">;</span>
    <span class="c1">// can not be compile-time constants</span>
    <span class="c1">// 不能因为是final，就认为在编译时可以知道它的值； 在运行时使用随机生产的数值来初始化</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">i4</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
    <span class="c1">// 装载时已经初始化了，而不是每次创建一个对象时都初始化</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">INT_5</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
    <span class="kd">private</span> <span class="n">Value</span> <span class="n">v1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Value</span><span class="o">(</span><span class="mi">11</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Value</span> <span class="n">v2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Value</span><span class="o">(</span><span class="mi">22</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Value</span> <span class="n">VAL_3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Value</span><span class="o">(</span><span class="mi">33</span><span class="o">);</span>
    <span class="c1">// Arrays</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;id:&quot;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&quot; i4:&quot;</span> <span class="o">+</span> <span class="n">i4</span> <span class="o">+</span> <span class="s">&quot; INT_5:&quot;</span> <span class="o">+</span> <span class="n">INT_5</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">FinalData</span> <span class="n">fd1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FinalData</span><span class="o">(</span><span class="s">&quot;fd1&quot;</span><span class="o">);</span>

<span class="c1">//        fd1.valueOne++; // error: cannot change value</span>
        <span class="n">fd1</span><span class="o">.</span><span class="na">v2</span><span class="o">.</span><span class="na">i</span> <span class="o">++;</span> <span class="c1">//Object is not constant</span>
        <span class="n">fd1</span><span class="o">.</span><span class="na">v1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Value</span><span class="o">(</span><span class="mi">9</span><span class="o">);</span> <span class="c1">// ok , not final</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">fd1</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">fd1</span><span class="o">.</span><span class="na">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">++;</span> <span class="c1">// Object is not constant</span>
        <span class="o">}</span>
<span class="c1">//        fd1.v2 = new Value(0); //error, can not， 无法将v2再指向其它对象引用，v2是final类型的</span>
<span class="c1">//        fd1.VAL_3 = new Value(1); // change reference，error同上</span>
<span class="c1">//        fd1.a = new int[3]; // 数组也一样， error同上</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fd1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creating new FinalData&quot;</span><span class="o">);</span>
        <span class="n">FinalData</span> <span class="n">fd2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FinalData</span><span class="o">(</span><span class="s">&quot;fd2&quot;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fd1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fd2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/* output</span>
<span class="cm"> id:fd1 i4:15 INT_5:18</span>
<span class="cm"> Creating new FinalData</span>
<span class="cm"> id:fd1 i4:15 INT_5:18</span>
<span class="cm"> id:fd2 i4:13 INT_5:18</span>
<span class="cm"> */</span>
</pre></div>


<ul>
<li><code>final</code> 和 <code>static final</code> 的区别</li>
</ul>
<h3 id="final">final 参数</h3>
<p>在参数列表中以声明的方式将参数指明为final, 这意味着你无法在方法中更改参数引用所指向的对象</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">with</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">a</span><span class="o">){</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span> <span class="c1">// illegal, a is final</span>
<span class="o">}</span>
</pre></div>


<h3 id="final_1">final 方法</h3>
<p>final 方法的使用的两个原因</p>
<ol>
<li>将方法锁定， 以防止任何继承类修改它的含义</li>
<li>效率：Java早期实现中，如果将一个方法指明为final, 就是同意编译器将针对该方法的所有调用都转为内嵌调用，以代码副本代替方法调用，可能消除方法调用的开销。如果一个方法很大，则程序代码就会膨胀，可能看不到内嵌带来的任何性能提高，因为，所带来的性能提高会话费于防范诶的时间量而被压缩。（最近的Java版本已经优化此过程）</li>
</ol>
<p>private 由于无法 使用，所以 private 加上 final 修饰词，并没有实际的意义</p>
<div class="hlcode"><pre><span class="kd">class</span> <span class="nc">WithFinalMethod</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">E21_FinalMethod</span> <span class="kd">extends</span> <span class="n">WithFinalMethod</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// 报错,final方法无法override</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></div>


<h3 id="final_2">final 类</h3>
<p>不允许继承，不能有子类</p>
<h2 id="_2">初始化及类的加载</h2>
<ul>
<li>
<p>加载类的动作仅发生一次</p>
</li>
<li>
<p>类的第一个实例的创建或者对static成员的访问都有可能引起加载</p>
</li>
<li>
<p>定义为static的东西，只会被初始化一次</p>
</li>
</ul>
<div class="hlcode"><pre><span class="kd">class</span> <span class="nc">LoadTest</span> <span class="o">{</span>
    <span class="c1">// The static clause is executed</span>
    <span class="c1">// upon class loading:</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Loading LoadTest&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">staticMember</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Calling static member&quot;</span><span class="o">);</span>
        <span class="n">LoadTest</span><span class="o">.</span><span class="na">staticMember</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creating an object&quot;</span><span class="o">);</span>
        <span class="k">new</span> <span class="nf">LoadTest</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*output</span>

<span class="cm">Calling static member</span>
<span class="cm">Loading LoadTest</span>
<span class="cm">Creating an object</span>
<span class="cm"> */</span>
</pre></div>


<p>巩固学习：<a href="./05.md">第5章，总结一个对象的创建过程</a></p>
<div class="hlcode"><pre><span class="kd">class</span> <span class="nc">LoadTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">LoadTest</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;LoadTest constructor&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Loading LoadTest&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">staticMember</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Calling static member&quot;</span><span class="o">);</span>
        <span class="n">LoadTest</span><span class="o">.</span><span class="na">staticMember</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creating an object&quot;</span><span class="o">);</span>
        <span class="k">new</span> <span class="nf">LoadTest</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">LoadTest</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*output</span>

<span class="cm">Calling static member</span>
<span class="cm">Loading LoadTest</span>
<span class="cm">Creating an object</span>
<span class="cm">LoadTest constructor</span>
<span class="cm">LoadTest constructor</span>
<span class="cm"> */</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 doctording.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-03-11 23:33:43</p>
      </span>
    </div>

    
    
  </body>
</html>